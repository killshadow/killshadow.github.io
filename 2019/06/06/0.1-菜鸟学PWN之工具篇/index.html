<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>0.1-菜鸟学PWN之工具篇 | Live to change world</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="0x00 简介 本章介绍在CTF PWN中常用工具的使用及其快捷键，尽量用最短的学习时间快速入门这些工具的使用。随着工具的增多以及其功能的丰富，本章会不定期更新。">
<meta name="keywords" content="CTF,Tools">
<meta property="og:type" content="article">
<meta property="og:title" content="0.1-菜鸟学PWN之工具篇">
<meta property="og:url" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/index.html">
<meta property="og:site_name" content="Live to change world">
<meta property="og:description" content="0x00 简介 本章介绍在CTF PWN中常用工具的使用及其快捷键，尽量用最短的学习时间快速入门这些工具的使用。随着工具的增多以及其功能的丰富，本章会不定期更新。">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/20160911173905858.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/4332232-fd8690b7cd9cfc90.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/4332232-eae756a3f89ed9c1.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/创建及使用结构体.gif">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/1543161992885.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/1543162127685.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/1543162468087.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/8343187-5785fafa96954e2f.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/8343187-bcc26a65304b68f9.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/8343187-b07fa424356cb45f.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/2.3.1_gdb.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/1543165695976.png">
<meta property="og:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/1543164648498.png">
<meta property="og:updated_time" content="2019-06-06T07:23:18.587Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="0.1-菜鸟学PWN之工具篇">
<meta name="twitter:description" content="0x00 简介 本章介绍在CTF PWN中常用工具的使用及其快捷键，尽量用最短的学习时间快速入门这些工具的使用。随着工具的增多以及其功能的丰富，本章会不定期更新。">
<meta name="twitter:image" content="http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/20160911173905858.png">
  
    <link rel="alternative" href="/atom.xml" title="Live to change world" type="application/atom+xml">
  
  
    <link rel="icon" href="//assets/img/wolf_track.ico">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet" />
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: false,
          isPost: true,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>
<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
        <a href="/" class="profilepic">
            
            <img lazy-src="/assets/img/head.png" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">killshadow</a></h1>
        </hgroup>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="搜索一下" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a  href="http://www.killshadow.xyz/">博客首页</a></li>
                        
                            <li><a  href="/archives">文章归档</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl github"  target="_blank" href="https://www.github.com/killshadow" title="github">github</a>
                            
                                <a class="fl zhihu"  target="_blank" href="https://www.zhihu.com/people/0038/" title="zhihu">zhihu</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <a href="/tags/Android-Developer/" style="font-size: 13.33px;">Android Developer</a> <a href="/tags/CTF/" style="font-size: 20px;">CTF</a> <a href="/tags/Deep-Learning/" style="font-size: 10px;">Deep Learning</a> <a href="/tags/MISC/" style="font-size: 16.67px;">MISC</a> <a href="/tags/Mobile-Security/" style="font-size: 10px;">Mobile Security</a> <a href="/tags/PWN/" style="font-size: 13.33px;">PWN</a> <a href="/tags/Reverse/" style="font-size: 10px;">Reverse</a> <a href="/tags/Tools/" style="font-size: 10px;">Tools</a> <a href="/tags/Wireless/" style="font-size: 10px;">Wireless</a>
                    </div>
                </section>
                
                
                
                
                <section class="switch-part switch-part3">
                
                    <div id="js-aboutme">潜心修行，勿忘初心</div>
                </section>
                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">killshadow</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="//assets/img/head.png" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">killshadow</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="http://www.killshadow.xyz/">博客首页</a></li>
                
                    <li><a href="/archives">文章归档</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="github" target="_blank" href="https://www.github.com/killshadow" title="github">github</a>
                    
                        <a class="zhihu" target="_blank" href="https://www.zhihu.com/people/0038/" title="zhihu">zhihu</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap"><article id="post-0.1-菜鸟学PWN之工具篇" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/06/06/0.1-菜鸟学PWN之工具篇/" class="article-date">
      <time datetime="2019-06-06T03:34:00.000Z" itemprop="datePublished">2019-06-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      0.1-菜鸟学PWN之工具篇
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        

        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CTF/">CTF</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Tools/">Tools</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="x00-简介">0x00 简介</h2>
<p>本章介绍在CTF PWN中常用工具的使用及其快捷键，尽量用最短的学习时间快速入门这些工具的使用。随着工具的增多以及其功能的丰富，本章会不定期更新。</p>
<a id="more"></a>
<h2 id="x10-ida-pro">0x10 IDA Pro</h2>
<h3 id="x11-快捷键">0x11 快捷键</h3>
<p>IDA快捷键如下表：</p>
<table>
<thead>
<tr class="header">
<th>快捷键</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>;</td>
<td>为当前指令添加全文交叉引用的注释</td>
</tr>
<tr class="even">
<td>/</td>
<td>在汇编中可见c代码</td>
</tr>
<tr class="odd">
<td>n</td>
<td>定义或修改名称，通常用来标注函数名</td>
</tr>
<tr class="even">
<td>g</td>
<td>跳转到任意地址</td>
</tr>
<tr class="odd">
<td>Esc</td>
<td>返回到跳转前的位置</td>
</tr>
<tr class="even">
<td>D</td>
<td>分别按字节、字、双字显示数据</td>
</tr>
<tr class="odd">
<td>A</td>
<td>按 ASCII 显示数据</td>
</tr>
<tr class="even">
<td>u</td>
<td>取消定义一个函数或变量等</td>
</tr>
<tr class="odd">
<td>p</td>
<td>将一段16进制解析成函数(相当于u[undefine]相反的操作)</td>
</tr>
<tr class="even">
<td>alt + p</td>
<td>编辑function, 可定义函数的范围(起始/终止地址)</td>
</tr>
<tr class="odd">
<td>x</td>
<td>查看交叉引用</td>
</tr>
<tr class="even">
<td>h</td>
<td>16/10进制转换</td>
</tr>
<tr class="odd">
<td>r</td>
<td>转换成字符串</td>
</tr>
<tr class="even">
<td>空格键</td>
<td>反汇编窗口切换文本跟图形</td>
</tr>
<tr class="odd">
<td>F9</td>
<td>动态调试程序(其实IDA主要用作静态分析用的)</td>
</tr>
<tr class="even">
<td>F2</td>
<td>下断点</td>
</tr>
<tr class="odd">
<td>N</td>
<td>重命名</td>
</tr>
<tr class="even">
<td>Y</td>
<td>设置变量类型</td>
</tr>
<tr class="odd">
<td>M</td>
<td>转换为枚举类型常量</td>
</tr>
<tr class="even">
<td>ALT+G</td>
<td>转换局部变量为结构体</td>
</tr>
</tbody>
</table>
<ol type="1">
<li>IDAView下使用小键盘“-”，“+”快捷方式可以在代码同关系图之间切换。</li>
<li>使用快捷键”*”把变量重定义为数组.</li>
<li>ALT+T:搜索字符串(文本搜索)</li>
<li>alt+B:搜索opcode(二进制数据),搜索16进制:</li>
</ol>
<h3 id="x12-常用插件">0x12 常用插件</h3>
<p>插件链接及功能如下:</p>
<ul>
<li><a href="https://github.com/push0ebp/sig-database" target="_blank" rel="noopener">IDA FLIRT Signature Database</a> -- 用于识别静态编译的可执行文件中的库函数</li>
<li><a href="https://github.com/polymorf/findcrypt-yara" target="_blank" rel="noopener">Find Crypt</a> -- 寻找常用加密算法中的常数（需要安装 <a href="https://github.com/VirusTotal/yara-python" target="_blank" rel="noopener">yara-python</a>）</li>
<li><a href="https://github.com/nihilus/IDA_Signsrch" target="_blank" rel="noopener">IDA signsrch</a> -- 寻找二进制文件所使用的加密、压缩算法</li>
<li><a href="https://github.com/illera88/Ponce" target="_blank" rel="noopener">Ponce</a> -- 污点分析和符号化执行工具</li>
<li><a href="https://github.com/yegord/snowman/tree/v0.1.0" target="_blank" rel="noopener">snowman decompiler</a> -- C/C++反汇编插件（F3 进行反汇编）</li>
<li><a href="https://github.com/REhints/HexRaysCodeXplorer" target="_blank" rel="noopener">CodeXplorer</a> -- 自动类型重建以及对象浏览（C++）（jump to disasm)</li>
<li><a href="https://github.com/nologic/idaref" target="_blank" rel="noopener">IDA Ref</a> -- 汇编指令注释（支持arm，x86，mips）</li>
<li><a href="https://github.com/a1ext/auto_re" target="_blank" rel="noopener">auto re</a> -- 函数自动重命名</li>
<li><a href="https://github.com/tkmru/nao" target="_blank" rel="noopener">nao</a> -- dead code 清除</li>
<li><a href="https://github.com/igogo-x86/HexRaysPyTools" target="_blank" rel="noopener">HexRaysPyTools</a> -- 类/结构体创建和虚函数表检测</li>
<li><a href="https://github.com/ynvb/DIE" target="_blank" rel="noopener">DIE</a> -- 动态调试增强工具，保存函数调用上下文信息</li>
<li><a href="https://github.com/cseagle/sk3wldbg" target="_blank" rel="noopener">sk3wldbg</a> -- IDA 动态调试器，支持多平台</li>
<li><a href="https://github.com/36hours/idaemu" target="_blank" rel="noopener">idaemu</a> -- 模拟代码执行（支持X86、ARM平台）</li>
<li><a href="https://github.com/joxeankoret/diaphora" target="_blank" rel="noopener">Diaphora</a> -- 程序差异比较</li>
<li><a href="https://github.com/keystone-engine/keypatch" target="_blank" rel="noopener">Keypatch</a> -- 基于 Keystone 的 Patch 二进制文件插件</li>
<li><a href="https://github.com/alexhude/FRIEND" target="_blank" rel="noopener">FRIEND</a> -- 哪里不会点哪里，提升汇编格式的可读性、提供指令、寄存器的文档等</li>
<li><a href="https://github.com/fireeye/SimplifyGraph" target="_blank" rel="noopener">SimplifyGraph</a> -- 简化复杂的函数流程图</li>
<li><a href="https://github.com/airbus-seclab/bincat" target="_blank" rel="noopener">bincat</a> -- 静态二进制代码分析工具包，2017 Hex-Rays 插件第一名</li>
<li><a href="https://github.com/strazzere/golang_loader_assist" target="_blank" rel="noopener">golang_loader_assist</a> -- Golang编译的二进制文件分析助手</li>
<li><a href="https://www.zynamics.com/bindiff.html" target="_blank" rel="noopener">BinDiff</a></li>
</ul>
<h3 id="x13-常用技巧">0x13 常用技巧</h3>
<h4 id="堆栈不平衡">① 堆栈不平衡</h4>
<p>某些函数在使用 f5 进行反编译时，会提示错误 "sp-analysis failed"，导致无法正确反编译。原因可能是在代码执行中的 pop、push 操作不匹配，导致解析的时候 esp 发生错误。</p>
<p>解决办法步骤如下：</p>
<ol type="1">
<li>用 Option-&gt;General-&gt;Disassembly, 将选项 Stack pointer 打钩</li>
<li>仔细观察每条 call sub_xxxxxx 前后的堆栈指针是否平衡</li>
<li>有时还要看被调用的 sub_xxxxxx 内部的堆栈情况，主要是看入栈的参数与 ret xx 是否匹配</li>
<li>注意观察 jmp 指令前后的堆栈是否有变化</li>
<li>有时用 Edit-&gt;Functions-&gt;Edit function...,然后点击 OK 刷一下函数定义</li>
</ol>
<h4 id="分析选项">② 分析选项</h4>
<p>选择File菜单下的Open，打开想要逆向的可执行文件，会显示一个Load a new file的界面。这里可以选择: </p>
<ol type="1">
<li>程序的类型； </li>
<li>处理器的类型； </li>
<li>加载的段地址和偏移量； </li>
<li>是否允许分析； </li>
<li>一些加载选项； </li>
<li>内核和处理器的一些选项； </li>
<li>windows系统dll所在的目录。</li>
</ol>
<div style="text-align: center;">
<figure>
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/20160911173905858.png" alt="Processor type中可选择CPU指令集"><figcaption>Processor type中可选择CPU指令集</figcaption>
</figure>
</div>
<p>​ 上图默认选择PE文件就可以，对于一些网络数据包或者其他格式的文件，可以使用二进制加载，自己进行解析。</p>
<h4 id="修改数据">③ 修改数据</h4>
<ul>
<li>如何修改数据:(在Hex View窗口下) [S1]双击要修改的地方 [S2]使用F2捷方式修改当前字节 [S3]再按下F2快捷方式应用修改。</li>
<li>如何改变执行流程  [1]修改跳转指令。  [2]修改内存数据。  [3]IDA View中使用下面的命令Jump to IP,Set IP, Run to cursor。 </li>
<li>保存修改  使用下面的主菜单命令，直接把修改保存到输入文件中,即可。  [IDA Main Menu]-&gt;[Edit]-&gt;[PatchProgram]-&gt;[Apply patches to input file…]</li>
</ul>
<h4 id="创建结构体">④ 创建结构体</h4>
<ol type="1">
<li><p>在IDA中打开Structures，快捷键是<code>shift+ F9</code> ,然后按insert键，插入新结构体:</p>
<div style="text-align: center;">
<figure>
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/4332232-fd8690b7cd9cfc90.png" alt="输入结构题的名称"><figcaption>输入结构题的名称</figcaption>
</figure>
</div></li>
<li><p>在<code>ends</code>后按<code>d</code>键，添加相应的成员，然后选中成员名，按<code>N</code>进行修改，选中类型，按<code>d</code>进行更改类型，构造完结构题以后，回到代码窗口</p>
<div style="text-align: center;">
<figure>
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/4332232-eae756a3f89ed9c1.png" alt="修改成员名及其类型"><figcaption>修改成员名及其类型</figcaption>
</figure>
</div></li>
<li><p>在变量堆栈结构里, <code>Edit▶Struct Var（ALT+Q）</code>命令显示一组已知的结构体</p></li>
<li><p>跳到要定义结构体的变量, 按<code>y</code>, 把它改成<code>(新定义结构体名) *</code>.</p>
<div style="text-align: center;">
<figure>
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/创建及使用结构体.gif" alt="创建及使用结构体"><figcaption>创建及使用结构体</figcaption>
</figure></div></li>
</ol>
<h4 id="解析c头文件">⑤ 解析C头文件</h4>
<p>解析头文件，可以使用File▶Load File▶Parse C HeaderFile（文件▶加载文件▶解析C头文件）选择你想要解析的头文件。如果一切正常，IDA会通知你Compilation successful（编译完成）。如果解析器遇到任何问题，IDA将会在输出窗口中显示错误消息</p>
<h4 id="定义数组">⑥ 定义数组</h4>
<p>当看到这样的多个变量:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">v2 = <span class="number">102</span>;</span><br><span class="line">v3 = <span class="number">109</span>;</span><br><span class="line">v4 = <span class="number">99</span>;</span><br><span class="line">v5 = <span class="number">100</span>;</span><br><span class="line">v6 = <span class="number">127</span>;</span><br><span class="line">v7 = <span class="number">107</span>;</span><br><span class="line">v8 = <span class="number">55</span>;</span><br><span class="line">v9 = <span class="number">100</span>;</span><br><span class="line">v10 = <span class="number">59</span>;</span><br><span class="line">v11 = <span class="number">86</span>;</span><br><span class="line">v12 = <span class="number">96</span>;</span><br><span class="line">v13 = <span class="number">59</span>;</span><br><span class="line">v14 = <span class="number">110</span>;</span><br><span class="line">v15 = <span class="number">112</span>;</span><br></pre></td></tr></table></figure>
<div style="text-align: center;">
<figure>
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/1543161992885.png" alt="堆栈视图的数组"><figcaption>堆栈视图的数组</figcaption>
</figure>
</div>
<p>可以考虑只定义一个数组, 按<code>*</code>, 会弹出如下窗口:</p>
<div style="text-align: center;">
<figure>
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/1543162127685.png" alt="定义数组"><figcaption>定义数组</figcaption>
</figure>
</div>
<p>要特别注意<code>array size</code>.</p>
<h4 id="动态调试-远程调试">⑦ 动态调试 &amp; 远程调试</h4>
<ol type="1">
<li><p>如果在win系统上调试<code>exe</code>文件, 则可以直接用本地debugger调试, 按<code>F9</code>之后会跳出如下界面:</p>
<div style="text-align: center;">
<figure>
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/1543162468087.png" alt="本地动态调试"><figcaption>本地动态调试</figcaption>
</figure>
</div>
<p>选<code>Local ...</code>. 即可动态调试. (调试时记得在关键点按<code>F2</code>下断点)</p></li>
<li><p>如果在win下动态调elf或so文件, 则需要利用到远程调试(一般是本地ida远程连接linux虚拟机来调试)</p>
<p>Step1: 将IDA安装目录下的linux_server/linux_server64复制到linux虚拟机，在linux下执行linux_server(32/64, 看程序而定)</p>
<p>Step2: 在Windows下打开需要反汇编的ELF格式文件，并在IDA上配置远程调试的环境：Debugger——Attach——Remote Linux debugger，选<code>Remote Linux debugger</code>:</p>
<div style="text-align: center;">
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/8343187-5785fafa96954e2f.png" title="fig:" alt="选Remote Linux debugger">
</div>
<p>Step3: 在Debug options勾选如上选项：</p>
<div style="text-align: center;">
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/8343187-bcc26a65304b68f9.png" title="fig:" alt="在Debug options勾选如上选项">
</div>
<p>Step4: Hostname为虚拟机ip，Password为空</p>
<div style="text-align: center;">
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/8343187-b07fa424356cb45f.png" title="fig:" alt="Hostname为虚拟机ip，Password为空">
</div></li>
<li><p>如果是so文件, 跟上述方法差不多, 需要额外注意adb shell下的端口转发.</p></li>
</ol>
<h3 id="x14-ida-python">0x14 IDA Python</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line"></span><br><span class="line">buf = ida_bytes.get_bytes(<span class="number">0x600B00</span>, <span class="number">182</span>)</span><br><span class="line">patch = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> buf:</span><br><span class="line">truepatch += chr(ord(i) ^ <span class="number">0x0C</span>)</span><br><span class="line">ida_bytes.patch_bytes(<span class="number">0x600B00</span>,patch)</span><br></pre></td></tr></table></figure>
<p>IDA Python API: <a href="https://www.hex-rays.com/products/ida/support/idapython_docs/" target="_blank" rel="noopener">https://www.hex-rays.com/products/ida/support/idapython_docs/</a></p>
<hr>
<h2 id="x20-gdb">0x20 GDB</h2>
<h3 id="x21-gdb-的组成架构">0x21 gdb 的组成架构</h3>
<div style="text-align: center;">
<figure>
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/2.3.1_gdb.png" alt="img"><figcaption>img</figcaption>
</figure>
</div>
<h3 id="x22-gdb-基本工作原理">0x22 gdb 基本工作原理</h3>
<p>gdb 通过系统调用 <code>ptrace</code> 来接管一个进程的执行。ptrace 系统调用提供了一种方法使得父进程可以观察和控制其它进程的执行，检查和改变其核心映像以及寄存器。它主要用来实现断点调试和系统调用跟踪。ptrace 系统调用的原型如下： <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/ptrace.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">ptrace</span><span class="params">(<span class="keyword">enum</span> __ptrace_request request, <span class="keyword">pid_t</span> pid, <span class="keyword">void</span> *addr, <span class="keyword">void</span> *data)</span></span>;</span><br></pre></td></tr></table></figure></p>
<p>对应的参数如下:</p>
<ul>
<li>pid_t pid：指示 ptrace 要跟踪的进程。</li>
<li>void *addr：指示要监控的内存地址。</li>
<li>void *data：存放读取出的或者要写入的数据。</li>
<li>enum __ptrace_request request：决定了系统调用的功能，几个主要的选项：
<ul>
<li><em>PTRACE_TRACEME</em>：表示此进程将被父进程跟踪，任何信号（除了 <code>SIGKILL</code>）都会暂停子进程，接着阻塞于 <code>wait()</code> 等待的父进程被唤醒。子进程内部对 <code>exec()</code> 的调用将发出 <code>SIGTRAP</code> 信号，这可以让父进程在子进程新程序开始运行之前就完全控制它。</li>
<li><em>PTRACE_ATTACH</em>：attach 到一个指定的进程，使其成为当前进程跟踪的子进程，而子进程的行为等同于它进行了一次 PTRACE_TRACEME 操作。但需要注意的是，虽然当前进程成为被跟踪进程的父进程，但是子进程使用 <code>getppid()</code> 的到的仍将是其原始父进程的 pid。</li>
<li><em>PTRACE_CONT</em>：继续运行之前停止的子进程。可同时向子进程交付指定的信号。</li>
</ul></li>
</ul>
<h4 id="gdb-的三种调试方式">gdb 的三种调试方式</h4>
<ol type="1">
<li>运行并调试一个新进程
<ul>
<li>运行 gdb，通过命令行或 <code>file</code> 命令指定目标程序。</li>
<li>输入<code>run</code>命令， gdb 执行下面的操作：
<ul>
<li>通过 <code>fork()</code> 系统调用创建一个新进程</li>
<li>在新创建的子进程中执行操作：<code>ptrace(PTRACE_TRACEME, 0, 0, 0)</code></li>
<li>在子进程中通过 <code>execv()</code> 系统调用加载用户指定的可执行文件</li>
</ul></li>
</ul></li>
<li>attach 并调试一个已经运行的进程
<ul>
<li>用户确定需要进行调试的进程 PID</li>
<li>运行 gdb，输入 <code>attach &lt;pid&gt;</code>，gdb 将对指定进程执行操作: <code>ptrace(PTRACE_ATTACH, pid, 0, 0)</code></li>
</ul></li>
<li>远程调试目标机上新创建的进程
<ul>
<li>gdb 运行在调试机上，gdbserver 运行在目标机上，两者之间的通信数据格式由 gdb 远程串行协议（Remote Serial Protocol）——定义<a href="https://blog.csdn.net/HMSIWTV/article/details/8759129" target="_blank" rel="noopener">RSP协议数据</a>的基本格式为： <code>$..........#xx</code></li>
<li>gdbserver 的启动方式相当于运行并调试一个新创建的进程</li>
</ul></li>
</ol>
<p>注意，在你将 gdb attach 到一个进程时，可能会出现这样的问题：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ attach 9091</span><br><span class="line">Attaching to process 9091</span><br><span class="line">ptrace: Operation not permitted.</span><br></pre></td></tr></table></figure>
<p>这是因为开启了内核参数 <code>ptrace_scope</code>：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat /proc/sys/kernel/yama/ptrace_scope</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>1 表示 True，此时普通用户进程是不能对其他进程进行 attach 操作的，当然你可以用 root 权限启动 gdb，但最好的办法还是关掉它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo 0 &gt; /proc/sys/kernel/yama/ptrace_scope</span></span><br></pre></td></tr></table></figure>
<h4 id="断点的实现">断点的实现</h4>
<p>断点的功能是通过内核信号实现的，在 x86 架构上，内核向某个地址打入断点，实际上就是往该地址写入断点指令 <code>INT 3</code>，即 <code>0xCC</code>。目标程序运行到这条指令之后会触发 <code>SIGTRAP</code> 信号，gdb 捕获这个信号，并根据目标程序当前停止的位置查询 gdb 维护的断点链表，若发现在该地址确实存在断点，则可判定为断点命中。</p>
<h3 id="x23-gdb-基本操作">0x23 gdb 基本操作</h3>
<p>使用 <code>-tui</code> 选项可以将代码显示在一个漂亮的交互式窗口中。</p>
<h4 id="break----b">break -- b</h4>
<ul>
<li><code>break</code> 当不带参数时，在所选栈帧中执行的下一条指令处设置断点。</li>
<li><code>break &lt;function&gt;</code> 在函数体入口处打断点。</li>
<li><code>break &lt;line&gt;</code> 在当前源码文件指定行的开始处打断点。</li>
<li><code>break -N</code> <code>break +N</code> 在当前源码行前面或后面的 <code>N</code> 行开始处打断点，<code>N</code> 为正整数。</li>
<li><code>break &lt;filename:line&gt;</code> 在源码文件 <code>filename</code> 的 <code>line</code> 行处打断点。</li>
<li><code>break &lt;filename:function&gt;</code> 在源码文件 <code>filename</code> 的 <code>function</code> 函数入口处打断点。</li>
<li><code>break &lt;address&gt;</code> 在程序指令的地址处打断点。</li>
<li><code>break ... if &lt;cond&gt;</code> 设置条件断点，<code>...</code> 代表上述参数之一（或无参数），<code>cond</code> 为条件表达式，仅在 <code>cond</code> 值非零时停住程序。</li>
</ul>
<h4 id="info">info</h4>
<ul>
<li><code>info breakpoints -- i b</code> 查看断点，观察点和捕获点的列表。
<ul>
<li><code>info breakpoints [list…]</code></li>
</ul></li>
<li><code>info break [list…]</code>
<ul>
<li><code>list…</code> 用来指定若干个断点的编号（可省略），可以是 <code>2</code>， <code>1-3</code>， <code>2 5</code>等。</li>
</ul></li>
<li><code>info display</code> 打印自动显示的表达式列表，每个表达式都带有项目编号，但不显示其值。</li>
<li><code>info reg</code> 显示当前寄存器信息。</li>
<li><code>info threads</code> 打印出所有线程的信息，包含 Thread ID、Target ID 和 Frame。</li>
<li><code>info frame</code> 打印出指定栈帧的详细信息。</li>
<li><code>info proc</code> 查看 proc 里的进程信息。</li>
</ul>
<h4 id="disable----dis">disable -- dis</h4>
<p>禁用断点，参数使用空格分隔。不带参数时禁用所有断点。</p>
<ul>
<li><code>disable [breakpoints] [list…]</code> <code>breakpoints</code> 是 <code>disable</code> 的子命令（可省略），<code>list…</code> 同 <code>info breakpoints</code> 中的描述。</li>
</ul>
<h4 id="enable">enable</h4>
<p>启用断点，参数使用空格分隔。不带参数时启用所有断点。</p>
<ul>
<li><code>enable [breakpoints] [list…]</code> 启用指定的断点（或所有定义的断点）。</li>
<li><code>enable [breakpoints] once list…</code> 临时启用指定的断点。GDB 在停止您的程序后立即禁用这些断点。</li>
<li><code>enable [breakpoints] delete list…</code> 使指定的断点启用一次，然后删除。一旦您的程序停止，GDB 就会删除这些断点。等效于用 <code>tbreak</code> 设置的断点。</li>
</ul>
<p><code>breakpoints</code> 同 <code>disable</code> 中的描述。</p>
<h4 id="clear">clear</h4>
<p>在指定行或函数处清除断点。参数可以是行号，函数名称或 <code>*</code> 跟一个地址。</p>
<ul>
<li><code>clear</code> 当不带参数时，清除所选栈帧在执行的源码行中的所有断点。</li>
<li><code>clear &lt;function&gt;</code>, <code>clear &lt;filename:function&gt;</code> 删除在命名函数的入口处设置的任何断点。</li>
<li><code>clear &lt;line&gt;</code>, <code>clear &lt;filename:line&gt;</code> 删除在指定的文件指定的行号的代码中设置的任何断点。</li>
<li><code>clear &lt;address&gt;</code> 清除指定程序指令的地址处的断点。</li>
</ul>
<h4 id="delete----d">delete -- d</h4>
<p>删除断点。参数使用空格分隔。不带参数时删除所有断点。</p>
<ul>
<li><code>delete [breakpoints] [list…]</code></li>
</ul>
<h4 id="tbreak">tbreak</h4>
<p>设置临时断点。参数形式同 <code>break</code> 一样。当第一次命中时被删除。</p>
<h4 id="watch">watch</h4>
<p>为表达式设置观察点。每当一个表达式的值改变时，观察点就会停止执行您的程序。</p>
<ul>
<li><code>watch [-l|-location] &lt;expr&gt;</code> 如果给出了 <code>-l</code> 或者 <code>-location</code>，则它会对 <code>expr</code> 求值并观察它所指向的内存。</li>
</ul>
<p>另外 <code>rwatch</code> 表示在访问时停止，<code>awatch</code> 表示在访问和改变时都停止。</p>
<h4 id="step----s">step -- s</h4>
<p>单步执行程序，直到到达不同的源码行。</p>
<ul>
<li><code>step [N]</code> 参数 <code>N</code> 表示执行 N 次（或由于另一个原因直到程序停止）。</li>
</ul>
<h4 id="reverse-step">reverse-step</h4>
<p>反向步进程序，直到到达另一个源码行的开头。</p>
<ul>
<li><code>reverse-step [N]</code> 参数 <code>N</code> 表示执行 N 次（或由于另一个原因直到程序停止）。</li>
</ul>
<h4 id="next----n">next -- n</h4>
<p>单步执行程序，执行完子程序调用。</p>
<ul>
<li><code>next [N]</code>与 <code>step</code> 不同，如果当前的源代码行调用子程序，则此命令不会进入子程序，而是继续执行，将其视为单个源代码行。</li>
</ul>
<h4 id="reverse-next">reverse-next</h4>
<p>反向步进程序，执行完子程序调用。</p>
<ul>
<li><code>reverse-next [N]</code></li>
</ul>
<p>如果要执行的源代码行调用子程序，则此命令不会进入子程序，调用被视为一个指令。</p>
<h4 id="return">return</h4>
<p>您可以使用 <code>return</code> 命令取消函数调用的执行。如果你给出一个表达式参数，它的值被用作函数的返回值。</p>
<ul>
<li><code>return &lt;expression&gt;</code> 将 <code>expression</code> 的值作为函数的返回值并使函数直接返回。</li>
</ul>
<h4 id="finish----fin">finish -- fin</h4>
<p>执行直到选定的栈帧返回。</p>
<ul>
<li><code>finish</code></li>
</ul>
<h4 id="until----u">until -- u</h4>
<p>执行程序直到大于当前栈帧或当前栈帧中的指定位置（与 <code>break</code> 命令相同的参数）的源码行。此命令常用于通过一个循环，以避免单步执行。</p>
<ul>
<li><code>until &lt;location&gt;</code> 继续运行程序，直到达到指定的位置，或者当前栈帧返回。</li>
</ul>
<h4 id="continue----c">continue -- c</h4>
<p>在信号或断点之后，继续运行被调试的程序。</p>
<ul>
<li><code>continue [N]</code></li>
</ul>
<p>如果从断点开始，可以使用数字 <code>N</code> 作为参数，这意味着将该断点的忽略计数设置为 <code>N - 1</code>(以便断点在第 N 次到达之前不会中断)。</p>
<h4 id="print----p">print -- p</h4>
<p>求表达式 expr 的值并打印。可访问的变量是所选栈帧的词法环境，以及范围为全局或整个文件的所有变量。</p>
<ul>
<li><code>print [expr]</code></li>
<li><code>print /f [expr]</code> 通过指定 <code>/f</code> 来选择不同的打印格式，其中 <code>f</code> 是一个指定格式的字母</li>
</ul>
<h4 id="x">x</h4>
<p>检查内存。</p>
<ul>
<li><code>x/nfu &lt;addr&gt;</code></li>
<li><code>x &lt;addr&gt;</code>
<ul>
<li><code>n</code>, <code>f</code>, 和 <code>u</code> 都是可选参数，用于指定要显示的内存以及如何格式化。</li>
<li><code>addr</code> 是要开始显示内存的地址的表达式。</li>
<li><code>n</code> 重复次数（默认值是 1），指定要显示多少个单位（由 <code>u</code> 指定）的内存值。</li>
<li><code>f</code> 显示格式（初始默认值是 <code>x</code>），显示格式是 <code>print('x'，'d'，'u'，'o'，'t'，'a'，'c'，'f'，'s')</code> 使用的格式之一，再加 <code>i</code>（机器指令）。</li>
<li><code>u</code> 单位大小，<code>b</code> 表示单字节，<code>h</code> 表示双字节，<code>w</code> 表示四字节，<code>g</code> 表示八字节。</li>
</ul></li>
</ul>
<h4 id="display">display</h4>
<p>每次程序停止时打印表达式 expr 的值。</p>
<ul>
<li><code>display &lt;expr&gt;</code></li>
<li><code>display/fmt &lt;expr&gt;</code></li>
<li><code>display/fmt &lt;addr&gt;</code></li>
</ul>
<p><code>fmt</code> 用于指定显示格式。对于格式 <code>i</code> 或 <code>s</code>，或者包括单位大小或单位数量，将表达式 <code>addr</code> 添加为每次程序停止时要检查的内存地址。</p>
<h4 id="disassemble----disas">disassemble -- disas</h4>
<p>反汇编命令。</p>
<ul>
<li><code>disas &lt;func&gt;</code> 反汇编指定函数</li>
<li><code>disas &lt;addr&gt;</code> 反汇编某地址所在函数</li>
<li><code>disas &lt;begin_addr&gt; &lt;end_addr&gt;</code> 反汇编从开始地址到结束地址的部分</li>
</ul>
<h4 id="undisplay">undisplay</h4>
<p>取消某些表达式在程序停止时自动显示。参数是表达式的编号（使用 <code>info display</code>查询编号）。不带参数表示取消所有自动显示表达式。</p>
<h4 id="disable-display">disable display</h4>
<p>禁用某些表达式在程序停止时自动显示。禁用的显示项目被再次启用。参数是表达式的编号（使用 <code>info display</code> 查询编号）。不带参数表示禁用所有自动显示表达式。</p>
<h4 id="enable-display">enable display</h4>
<p>启用某些表达式在程序停止时自动显示。参数是重新显示的表达式的编号（使用 <code>info display</code> 查询编号）。不带参数表示启用所有自动显示表达式。</p>
<h4 id="help----h">help -- h</h4>
<p>打印命令列表。</p>
<ul>
<li><code>help &lt;class&gt;</code> 您可以获取该类中各个命令的列表。</li>
<li><code>help &lt;command&gt;</code> 显示如何使用该命令的简述。</li>
</ul>
<h4 id="attach">attach</h4>
<p>挂接到 GDB 之外的进程或文件。将进程 ID 或设备文件作为参数。</p>
<ul>
<li><code>attach &lt;process-id&gt;</code></li>
</ul>
<h4 id="run----r">run -- r</h4>
<p>启动被调试的程序。可以直接指定参数，也可以用 <code>set args</code> 设置（启动所需的）参数。还允许使用 <code>&gt;</code>, <code>&lt;</code>, 或 <code>&gt;&gt;</code> 进行输入和输出重定向。</p>
<p>甚至可以运行一个脚本，如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run `python2 -c &apos;print &quot;A&quot;*100&apos;`</span><br></pre></td></tr></table></figure>
<h4 id="backtrace----bt">backtrace -- bt</h4>
<p>打印整个栈的回溯。</p>
<ul>
<li><code>bt</code> 打印整个栈的回溯，每个栈帧一行。</li>
<li><code>bt n</code> 类似于上，但只打印最内层的 n 个栈帧。</li>
<li><code>bt -n</code> 类似于上，但只打印最外层的 n 个栈帧。</li>
<li><code>bt full n</code> 类似于 <code>bt n</code>，还打印局部变量的值。</li>
</ul>
<blockquote>
<p>注意：使用 gdb 调试时，会自动关闭 ASLR，所以可能每次看到的栈地址都不变。</p>
</blockquote>
<h4 id="ptype">ptype</h4>
<p>打印类型 TYPE 的定义。</p>
<ul>
<li><code>ptype[/FLAGS] TYPE-NAME | EXPRESSION</code></li>
</ul>
<p>参数可以是由 <code>typedef</code> 定义的类型名， 或者 <code>struct STRUCT-TAG</code> 或者 <code>class CLASS-NAME</code> 或者 <code>union UNION-TAG</code> 或者 <code>enum ENUM-TAG</code>。</p>
<h4 id="set-follow-fork-mode">set follow-fork-mode</h4>
<p>当程序 fork 出一个子进程的时候，gdb 默认会追踪父进程（<code>set follow-fork-mode parent</code>），但也可以使用命令 <code>set follow-fork-mode child</code> 让其追踪子进程。</p>
<p>另外，如果想要同时追踪父进程和子进程，可以使用命令 <code>set detach-on-fork off</code>（默认为<code>on</code>），这样就可以同时调试父子进程，在调试其中一个进程时，另一个进程被挂起。如果想让父子进程同时运行，可以使用 <code>set schedule-multiple on</code>（默认为<code>off</code>）。</p>
<p>但如果程序是使用 exec 来启动了一个新的程序，可以使用 <code>set follow-exec-mode new</code>（默认为<code>same</code>） 来新建一个 inferior 给新程序，而父进程的 inferior 仍然保留。</p>
<h4 id="thread-apply-all-bt">thread apply all bt</h4>
<p>打印出所有线程的堆栈信息。</p>
<h4 id="generate-core-file">generate-core-file</h4>
<p>将调试中的进程生成内核转储文件。</p>
<h4 id="directory----dir">directory -- dir</h4>
<p>设置查找源文件的路径。</p>
<p>或者使用 gdb 的 <code>-d</code> 参数，例如：<code>gdb a.out -d /search/code/</code></p>
<h3 id="x24-gdb-peda-gdb-gef">0x24 gdb-peda (gdb-gef)</h3>
<p>当 gdb 启动时，它会在当前用户的主目录中寻找一个名为 <code>.gdbinit</code> 的文件；如果该文件存在，则 gdb 就执行该文件中的所有命令。通常，该文件用于简单的配置命令。但是 <code>.gdbinit</code> 的配置十分繁琐，因此对 gdb 的扩展通常用插件的方式来实现，通过 python 的脚本可以很方便的实现需要的功能。</p>
<p>PEDA（Python Exploit Development Assistance for GDB）是一个强大的 gdb 插件。它提供了高亮显示反汇编代码、寄存器、内存信息等人性化的功能。同时，PEDA 还有一些实用的新命令，比如 checksec 可以查看程序开启了哪些安全机制等等。</p>
<h4 id="安装">安装</h4>
<p>安装 peda 需要的软件包：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install nasm micro-inetd</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo apt-get install libc6-dbg vim ssh</span></span><br></pre></td></tr></table></figure>
<p>安装 peda：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> https://github.com/longld/peda.git ~/peda</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"source ~/peda/peda.py"</span> &gt;&gt; ~/.gdbinit</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> <span class="string">"DONE! debug your program with gdb and enjoy"</span></span></span><br></pre></td></tr></table></figure>
<p>如果系统为 Arch Linux，则可以直接安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> yaourt -S peda</span></span><br></pre></td></tr></table></figure>
<h4 id="peda命令">peda命令</h4>
<h5 id="aslr">aslr</h5>
<blockquote>
<p>显示/设置 gdb 的 ASLR</p>
</blockquote>
<h5 id="asmsearch">asmsearch</h5>
<blockquote>
<p>Search for ASM instructions in memory</p>
</blockquote>
<ul>
<li><code>asmsearch "int 0x80"</code></li>
<li><code>asmsearch "add esp, ?" libc</code> ##### assemble &gt; On the fly assemble and execute instructions using NASM</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">assemble $pc</span><br><span class="line">&gt; mov al, 0xb</span><br><span class="line">&gt; int 0x80</span><br><span class="line">&gt; end</span><br></pre></td></tr></table></figure>
<h5 id="checksec">checksec</h5>
<ul>
<li>检查二进制文件的安全选项</li>
</ul>
<h5 id="cmpmem">cmpmem</h5>
<ul>
<li>Compare content of a memory region with a file</li>
<li><code>cmpmem 0x08049000 0x0804a000 data.mem</code></li>
</ul>
<h5 id="context">context</h5>
<ul>
<li>Display various information of current execution context</li>
<li><code>context_code</code> -- Display nearby disassembly at $PC of current execution context</li>
<li><code>context_register</code> -- Display register information of current execution context</li>
<li><code>context_stack</code>- - Display stack of current execution context</li>
<li><code>context reg</code><br>
</li>
<li><code>context code</code></li>
<li><code>context stack</code></li>
</ul>
<h5 id="crashdump">crashdump</h5>
<ul>
<li>Display crashdump info and save to file</li>
</ul>
<h5 id="deactive">deactive</h5>
<ul>
<li>Bypass a function by ignoring its execution (eg sleep/alarm)</li>
<li><code>deactive setresuid</code></li>
<li><code>deactive chdir</code></li>
</ul>
<h5 id="distance">distance</h5>
<ul>
<li>Calculate distance between two addresses</li>
</ul>
<h5 id="dumpargs">dumpargs</h5>
<ul>
<li>在调用指令停止时显示传递给函数的参数</li>
</ul>
<h5 id="dumpmem">dumpmem</h5>
<ul>
<li>Dump content of a memory region to raw binary file -<code>dumpmem libc.mem libc</code></li>
</ul>
<h5 id="dumprop">dumprop</h5>
<ul>
<li>在特定的内存范围显示 ROP gadgets</li>
<li><code>dumprop binary "pop"</code></li>
</ul>
<h5 id="eflags">eflags</h5>
<ul>
<li>Display/set/clear/toggle value of eflags register</li>
<li><code>elfheader</code>
<ul>
<li>获取正在调试的 ELF 文件的头信息</li>
<li><code>elfheader</code></li>
</ul></li>
<li><code>elfheader .got</code></li>
</ul>
<h5 id="elfsymbol">elfsymbol</h5>
<ul>
<li>从 ELF 文件中获取没有调试信息的符号信息</li>
<li><code>elfsymbol</code></li>
<li><code>elfsymbol printfgennop</code></li>
</ul>
<h5 id="gennop">gennop</h5>
<ul>
<li>Generate abitrary length NOP sled using given characters</li>
<li><code>gennop 500</code></li>
<li><code>gennop 500 "\x90"</code></li>
</ul>
<h5 id="getfile">getfile</h5>
<ul>
<li>Get exec filename of current debugged process</li>
</ul>
<h5 id="getpid">getpid</h5>
<ul>
<li>Get PID of current debugged process</li>
</ul>
<h5 id="goto">goto</h5>
<ul>
<li>Continue execution at an address</li>
</ul>
<h5 id="help">help</h5>
<ul>
<li>Print the usage manual for PEDA commands</li>
</ul>
<h5 id="hexdump">hexdump</h5>
<ul>
<li>Display hex/ascii dump of data in memory</li>
<li><code>hexdump $sp 64</code></li>
<li><code>hexdump $sp /20</code></li>
</ul>
<h5 id="hexprint">hexprint</h5>
<ul>
<li>Display hexified of data in memory</li>
<li><code>hexprint $sp 64</code></li>
<li><code>hexprint $sp /20</code></li>
</ul>
<h5 id="jmpcall">jmpcall</h5>
<ul>
<li>Search for JMP/CALL instructions in memory</li>
<li><code>jmpcall eax</code></li>
<li><code>jmpcall esp libc</code></li>
</ul>
<h5 id="loadmem">loadmem</h5>
<ul>
<li>Load contents of a raw binary file to memory</li>
<li><code>loadmem stack.mem 0xbffdf000</code></li>
</ul>
<h5 id="lookup">lookup</h5>
<ul>
<li>搜索属于内存范围的地址的所有地址/引用</li>
<li><code>lookup address stack libc</code></li>
<li><code>lookup pointer stack ld-2</code></li>
</ul>
<h5 id="nearpc">nearpc</h5>
<ul>
<li>Disassemble instructions nearby current PC or given address</li>
<li><code>nearpc 20</code></li>
<li><code>nearpc 0x08048484</code></li>
</ul>
<h5 id="nextcall">nextcall</h5>
<ul>
<li>Step until next 'call' instruction in specific memory range</li>
<li><code>nextcall cpy</code></li>
</ul>
<h5 id="nextjmp">nextjmp</h5>
<ul>
<li>Step until next 'j*' instruction in specific memory range</li>
<li><code>nextjmp</code></li>
</ul>
<h5 id="nxtest">nxtest</h5>
<p>-- Perform real NX test to see if it is enabled/supported by OS</p>
<h5 id="patch">patch</h5>
<ul>
<li>使用字符串/十六进制字符串/整形数</li>
<li><code>patch $esp 0xdeadbeef</code></li>
<li><code>patch $eax "the long string"</code></li>
<li><code>patch (multiple lines)</code></li>
</ul>
<h5 id="pattern">pattern</h5>
<ul>
<li>生成，搜索或写入循环 pattern 到内存</li>
<li><code>pattern_arg</code> -- Set argument list with cyclic pattern</li>
<li><code>pattern_create</code> -- Generate a cyclic pattern</li>
<li><code>pattern_env</code> -- Set environment variable with a cyclic patter</li>
<li><code>pattern_offset</code> -- Search for offset of a value in cyclic pattern</li>
<li><code>pattern_patch</code> -- Write a cyclic pattern to memory</li>
<li><code>pattern_search</code> -- Search a cyclic pattern in registers and memory</li>
<li><code>pattern create 2000</code></li>
<li><code>pattern create 2000 input</code></li>
<li><code>pattern offset $pc</code></li>
<li><code>pattern search</code></li>
<li><code>pattern patch 0xdeadbeef 100</code></li>
</ul>
<h5 id="payload">payload</h5>
<ul>
<li>Generate various type of ROP payload using ret2plt</li>
<li><code>payload copybytes</code></li>
<li><code>payload copybytes target "/bin/sh"</code></li>
<li><code>payload copybytes 0x0804a010 offset</code></li>
</ul>
<h5 id="pdisass">pdisass</h5>
<ul>
<li>Format output of gdb disassemble command with colors</li>
<li><code>pdisass $pc /20</code></li>
</ul>
<h5 id="pltbreak">pltbreak</h5>
<ul>
<li>Set breakpoint at PLT functions match name regex</li>
<li><code>pltbreak cpy</code></li>
</ul>
<h5 id="procinfo">procinfo</h5>
<ul>
<li>显示调试进程的 /proc/pid/</li>
<li><code>procinfo</code></li>
<li><code>procinfo fd</code></li>
</ul>
<h5 id="profile">profile</h5>
<ul>
<li>Simple profiling to count executed instructions in the program</li>
</ul>
<h5 id="pyhelp">pyhelp</h5>
<ul>
<li>Wrapper for python built-in help</li>
<li><code>pyhelp peda</code></li>
<li><code>pyhelp hex2str</code></li>
</ul>
<h5 id="pshow">pshow</h5>
<ul>
<li>显示各种 PEDA 选项和其他设置</li>
<li><code>pshow</code></li>
<li><code>pshow option context</code></li>
</ul>
<h5 id="pset">pset</h5>
<ul>
<li>设置各种 PEDA 选项和其他设置</li>
<li><code>pset arg '"A"*200'</code></li>
<li><code>pset arg 'cyclic_pattern(200)'</code>
<ul>
<li><code>pset env EGG 'cyclic_pattern(200)'</code></li>
<li><code>pset option context "code,stack"</code></li>
<li><code>pset option badchars "\r\n"</code></li>
</ul></li>
</ul>
<h5 id="readelf">readelf</h5>
<ul>
<li>获取 ELF 的文件头信息</li>
<li><code>readelf libc .text</code></li>
</ul>
<h5 id="refsearch">refsearch</h5>
<ul>
<li>Search for all references to a value in memory ranges</li>
<li><code>refsearch "/bin/sh"</code></li>
<li><code>refsearch 0xdeadbeef</code></li>
</ul>
<h5 id="reload">reload</h5>
<ul>
<li>Reload PEDA sources, keep current options untouch</li>
</ul>
<h5 id="ropgadget">ropgadget</h5>
<ul>
<li>获取二进制或库的常见 ROP gadgets</li>
<li><code>ropgadget</code></li>
<li><code>ropgadget libc</code></li>
</ul>
<h5 id="ropsearch">ropsearch</h5>
<ul>
<li>搜索内存中的 ROP gadgets</li>
<li><code>ropsearch "pop eax"</code></li>
<li><code>ropsearch "xchg eax, esp" libc</code></li>
</ul>
<h5 id="searchmemfind">searchmem|find</h5>
<ul>
<li>搜索内存中的 pattern, 支持正则表达式搜索</li>
<li><code>find "/bin/sh" libc</code></li>
<li><code>find 0xdeadbeef all</code></li>
<li><code>find "..\x04\x08" 0x08048000 0x08049000</code></li>
<li><code>searchmem</code> -- Search for a pattern in memory; support regex search</li>
<li><code>session</code> -- Save/restore a working gdb session to file as a script</li>
</ul>
<h5 id="set">set</h5>
<ul>
<li>Set various PEDA options and other settings</li>
<li><code>set exec-wrapper ./exploit.py</code></li>
</ul>
<h5 id="sgrep">sgrep</h5>
<ul>
<li>Search for full strings contain the given pattern</li>
</ul>
<h5 id="shellcode">shellcode</h5>
<ul>
<li>生成或下载常见的 shellcode</li>
<li><code>shellcode x86/linux exec</code></li>
</ul>
<h5 id="show">show</h5>
<ul>
<li>Show various PEDA options and other settings</li>
</ul>
<h5 id="skeleton">skeleton</h5>
<ul>
<li>生成 python exploit 代码模板</li>
<li><code>skeleton argv exploit.py</code></li>
</ul>
<h5 id="skipi">skipi</h5>
<ul>
<li>Skip execution of next count instructions</li>
</ul>
<h5 id="snapshot">snapshot</h5>
<ul>
<li>Save/restore process's snapshot to/from file</li>
<li><code>snapshot save</code></li>
<li><code>snapshot restore</code></li>
</ul>
<h5 id="start">start</h5>
<ul>
<li>Start debugged program and stop at most convenient entry</li>
</ul>
<h5 id="stepuntil">stepuntil</h5>
<ul>
<li>Step until a desired instruction in specific memory range</li>
<li><code>stepuntil cmp</code></li>
<li><code>stepuntil xor</code></li>
</ul>
<h5 id="strings">strings</h5>
<ul>
<li>Display printable strings in memory</li>
<li><code>strings</code></li>
<li><code>strings binary 4</code></li>
</ul>
<h5 id="substr">substr</h5>
<ul>
<li>Search for substrings of a given string/number in memory</li>
</ul>
<h5 id="telescope">telescope</h5>
<ul>
<li>Display memory content at an address with smart dereferences</li>
<li><code>telescope 40</code></li>
<li><code>telescope 0xb7d88000 40</code></li>
</ul>
<h5 id="tracecall">tracecall</h5>
<ul>
<li>Trace function calls made by the program</li>
<li><code>tracecall</code></li>
<li><code>tracecall "cpy,printf"</code></li>
<li><code>tracecall "-puts,fflush"</code></li>
</ul>
<h5 id="traceinst">traceinst</h5>
<ul>
<li>Trace specific instructions executed by the program</li>
<li><code>traceinst 20</code></li>
<li><code>traceinst "cmp,xor"</code></li>
</ul>
<h5 id="unptrace">unptrace</h5>
<ul>
<li>Disable anti-ptrace detection</li>
<li><code>unptrace</code></li>
</ul>
<h5 id="utils">utils</h5>
<ul>
<li>Miscelaneous utilities from utils module</li>
</ul>
<h5 id="vmmap">vmmap</h5>
<ul>
<li>在调试过程中获取段的虚拟映射地址范围</li>
<li><code>cmmap</code></li>
<li><code>vmmap binary / libc</code>
<ul>
<li><code>vmmap 0xb7d88000</code></li>
</ul></li>
</ul>
<h5 id="waitfor">waitfor</h5>
<ul>
<li>Try to attach to new forked process; mimic "attach -waitfor"</li>
<li><code>waitfor</code><br>
</li>
<li><code>waitfor myprog -c</code></li>
</ul>
<h5 id="xinfo">xinfo</h5>
<ul>
<li>Display detail information of address/registers</li>
<li><code>xinfo register eax</code></li>
<li><code>xinfo 0xb7d88000</code></li>
</ul>
<h5 id="xormem">xormem</h5>
<ul>
<li>用一个 key 来对一个内存区域执行 XOR 操作</li>
<li><code>xormem 0x08049000 0x0804a000 “thekey”</code></li>
</ul>
<h5 id="xprint">xprint</h5>
<ul>
<li>Extra support to GDB's print command</li>
</ul>
<h5 id="xrefs">xrefs</h5>
<ul>
<li>Search for all call/data access references to a function/variable</li>
</ul>
<h5 id="xuntil">xuntil</h5>
<ul>
<li>Continue execution until an address or function</li>
</ul>
<h4 id="使用-peda-和-python-编写-gdb-脚本">使用 PEDA 和 Python 编写 gdb 脚本</h4>
<h5 id="pedacmd">pedacmd</h5>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 交互式命令</span><br></pre></td></tr></table></figure>
<ul>
<li>没有返回值
<ul>
<li>例如：<code>pedacmd.context_register()</code></li>
</ul>
<h5 id="peda">peda</h5>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 与 gdb 交互的后端功能</span><br></pre></td></tr></table></figure></li>
<li>有返回值
<ul>
<li>例如：<code>peda.getreg("eax")</code></li>
</ul></li>
</ul>
<h5 id="小工具">小工具</h5>
<ul>
<li>例如：<code>to_int()</code>、<code>format_address()</code></li>
<li>获得帮助
<ul>
<li><code>pyhelp peda</code></li>
<li><code>pyhelp hex2str</code></li>
</ul></li>
</ul>
<h5 id="单行交互式使用">单行／交互式使用</h5>
<ul>
<li><code>gdb-peda$ python print peda.get_vmmap()</code></li>
</ul>
<p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ python</span><br><span class="line">&gt; status = peda.get_status()</span><br><span class="line">&gt; while status == &quot;BREAKPOINT&quot;:</span><br><span class="line">&gt;    peda.execute(&quot;continue&quot;)</span><br><span class="line">&gt; end</span><br></pre></td></tr></table></figure></p>
<h5 id="外部脚本">外部脚本</h5>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># myscript.py</span><br><span class="line">def myrun(size):</span><br><span class="line">argv = cyclic_pattern(size)</span><br><span class="line">peda.execute(&quot;set arg %s&quot; % argv)</span><br><span class="line">peda.execute(&quot;run&quot;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb-peda$ source myscript.py</span><br><span class="line">gdb-peda$ python myrun(100)</span><br></pre></td></tr></table></figure>
<h2 id="x30-pwntools">0x30 pwntools</h2>
<h3 id="x31-安装">0x31 安装</h3>
<ol type="1">
<li><p>安装binutils：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Gallopsled/pwntools-binutils</span><br><span class="line">sudo apt-get install software-properties-common</span><br><span class="line">sudo apt-add-repository ppa:pwntools/binutils</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install binutils-arm-linux-gnu</span><br></pre></td></tr></table></figure></li>
<li><p>安装capstone：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/aquynh/capstone</span><br><span class="line">cd capstone</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure></li>
<li><p>安装pwntools:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libssl-dev</span><br><span class="line">sudo pip install pwntools</span><br></pre></td></tr></table></figure></li>
</ol>
<p>如果你在使用 Arch Linux，则可以通过 AUR 直接安装，这个包目前是由我维护的，如果有什么问题，欢迎与我交流：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ yaourt -S python2-pwntools</span><br><span class="line">或者</span><br><span class="line">$ yaourt -S python2-pwntools-git</span><br></pre></td></tr></table></figure>
<p>但是由于 Arch 没有 PPA 源，如果想要支持更多的体系结构（如 arm, aarch64 等），只能手动编译安装相应的 binutils，使用下面的脚本，注意将变量 <code>V</code> 和 <code>ARCH</code> 换成你需要的。<a href="https://ftp.gnu.org/gnu/binutils/" target="_blank" rel="noopener">binutils</a><a href="https://firmianay.gitbooks.io/ctf-all-in-one/content/src/others/2.4.1_pwntools/binutils.sh" target="_blank" rel="noopener">源码</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env bash</span></span><br><span class="line"></span><br><span class="line">V = 2.29   <span class="comment"># binutils version</span></span><br><span class="line">ARCH = arm <span class="comment"># target architecture</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line">wget -nc https://ftp.gnu.org/gnu/binutils/binutils-<span class="variable">$V</span>.tar.xz</span><br><span class="line">wget -nc https://ftp.gnu.org/gnu/binutils/binutils-<span class="variable">$V</span>.tar.xz.sig</span><br><span class="line"></span><br><span class="line"><span class="comment"># gpg --keyserver keys.gnupg.net --recv-keys C3126D3B4AE55E93</span></span><br><span class="line"><span class="comment"># gpg --verify binutils-$V.tar.xz.sig</span></span><br><span class="line"></span><br><span class="line">tar xf binutils-<span class="variable">$V</span>.tar.xz</span><br><span class="line"></span><br><span class="line">mkdir binutils-build</span><br><span class="line"><span class="built_in">cd</span> binutils-build</span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> AR=ar</span><br><span class="line"><span class="built_in">export</span> AS=as</span><br><span class="line"></span><br><span class="line">../binutils-<span class="variable">$V</span>/configure \</span><br><span class="line">    --prefix=/usr/<span class="built_in">local</span> \</span><br><span class="line">    --target=<span class="variable">$ARCH</span>-unknown-linux-gnu \</span><br><span class="line">    --<span class="built_in">disable</span>-static \</span><br><span class="line">    --<span class="built_in">disable</span>-multilib \</span><br><span class="line">    --<span class="built_in">disable</span>-werror \</span><br><span class="line">    --<span class="built_in">disable</span>-nls</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>测试安装是否成功：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>asm(<span class="string">'nop'</span>)</span><br><span class="line"><span class="string">'\x90'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>asm(<span class="string">'nop'</span>, arch=<span class="string">'arm'</span>)</span><br><span class="line"><span class="string">'\x00\xf0 \xe3'</span></span><br></pre></td></tr></table></figure>
<h3 id="x32-模块简介">0x32 模块简介</h3>
<p>Pwntools 分为两个模块，一个是 <code>pwn</code>，简单地使用 <code>from pwn import *</code> 即可将所有子模块和一些常用的系统库导入到当前命名空间中，是专门针对 CTF 比赛的；而另一个模块是 <code>pwnlib</code>，它更推荐你仅仅导入需要的子模块，常用于基于 pwntools 的开发。</p>
<p>下面是 pwnlib 的一些子模块（常用模块和函数加粗显示）：</p>
<ul>
<li><code>adb</code>：安卓调试桥</li>
<li><code>args</code>：命令行魔法参数</li>
<li><strong>asm</strong>：汇编和反汇编，支持 i386/i686/amd64/thumb 等</li>
<li><code>constants</code>：对不同架构和操作系统的常量的快速访问</li>
<li><code>config</code>：配置文件</li>
<li><code>context</code>：设置运行时变量</li>
<li><strong>dynelf</strong>：用于远程函数泄露</li>
<li><code>encoders</code>：对 shellcode 进行编码</li>
<li><strong>elf</strong>：用于操作 ELF 可执行文件和库</li>
<li><code>flag</code>：提交 flag 到服务器</li>
<li><strong>fmtstr</strong>：格式化字符串利用工具</li>
<li><strong>gdb</strong>：与 gdb 配合使用</li>
<li><code>libcdb</code>：libc 数据库</li>
<li><code>log</code>：日志记录</li>
<li><strong>memleak</strong>：用于内存泄露</li>
<li><strong>rop</strong>：ROP 利用模块，包括 rop 和 srop</li>
<li><code>runner</code>：运行 shellcode</li>
<li><strong>shellcraft</strong>：shellcode 生成器: <code>system('/bin/sh')</code></li>
<li><code>term</code>：终端处理</li>
<li><code>timeout</code>：超时处理</li>
<li><strong>tubes</strong>：能与 sockets, processes, ssh 等进行连接</li>
<li><code>ui</code>：与用户交互</li>
<li><code>useragents</code>：useragent 字符串数据库</li>
<li><strong>util</strong>：一些实用小工具</li>
</ul>
<h3 id="x33-使用-pwntools">0x33 使用 Pwntools</h3>
<p>下面我们对常用模块和函数做详细的介绍。</p>
<h4 id="tubes">tubes</h4>
<p>在一次漏洞利用中，首先当然要与二进制文件或者目标服务器进行交互，这就要用到 tubes 模块。</p>
<p>主要函数在 <code>pwnlib.tubes.tube</code> 中实现，子模块只实现某管道特殊的地方。四种管道和相对应的子模块如下：</p>
<ul>
<li>pwnlib.tubes.process：进程
<ul>
<li><code>&gt;&gt;&gt; p = process('/bin/sh')</code></li>
</ul></li>
<li><code>pwnlib.tubes.serialtube</code>：串口</li>
<li>·pwnlib.tubes.sock·：套接字
<ul>
<li><code>&gt;&gt;&gt; r = remote('127.0.0.1', 1080)</code></li>
<li><code>&gt;&gt;&gt; l = listen(1080)</code></li>
</ul></li>
<li><code>pwnlib.tubes.ssh</code>：SSH
<ul>
<li><code>&gt;&gt;&gt; s = ssh(host='example.com</code>, user='name', password='passwd')`</li>
</ul></li>
<li><code>pwnlib.tubes.tube</code> 中的主要函数：
<ul>
<li><code>interactive()</code>：可同时读写管道，相当于回到 shell 模式进行交互，在取得 shell 之后调用</li>
<li><code>recv(numb=1096, timeout=default)</code>：接收指定字节数的数据</li>
<li><code>recvall()</code>：接收数据直到 EOF</li>
<li><code>recvline(keepends=True)</code>：接收一行，可选择是否保留行尾的 <code>\n</code></li>
<li><code>recvrepeat(timeout=default)</code>：接收数据直到 EOF 或 timeout</li>
<li><code>recvuntil(delims, timeout=default)</code>：接收数据直到 delims 出现</li>
<li><code>send(data)</code>：发送数据</li>
<li><code>sendline(data)</code>：发送一行，默认在行尾加 <code>\n</code></li>
<li><code>close()</code>：关闭管道</li>
</ul></li>
</ul>
<p>下面是一个例子，先使用 listen 开启一个本地的监听端口，然后使用 remote 开启一个套接字管道与之交互：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; from pwn import *</span><br><span class="line">&gt;&gt;&gt; l = listen()</span><br><span class="line">[x] Trying to bind to 0.0.0.0 on port 0</span><br><span class="line">[x] Trying to bind to 0.0.0.0 on port 0: Trying 0.0.0.0</span><br><span class="line">[+] Trying to bind to 0.0.0.0 on port 0: Done</span><br><span class="line">[x] Waiting for connections on 0.0.0.0:46147</span><br><span class="line">&gt;&gt;&gt; r = remote(&apos;localhost&apos;, l.lport)</span><br><span class="line">[x] Opening connection to localhost on port 46147</span><br><span class="line">[x] Opening connection to localhost on port 46147: Trying ::1</span><br><span class="line">[x] Opening connection to localhost on port 46147: Trying 127.0.0.1</span><br><span class="line">[+] Opening connection to localhost on port 46147: Done</span><br><span class="line">&gt;&gt;&gt; [+] Waiting for connections on 0.0.0.0:46147: Got connection from 127.0.0.1 on port 38684</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; c = l.wait_for_connection()</span><br><span class="line">&gt;&gt;&gt; r.send(&apos;hello\n&apos;)</span><br><span class="line">&gt;&gt;&gt; c.recv()</span><br><span class="line">&apos;hello\n&apos;</span><br><span class="line">&gt;&gt;&gt; r.send(&apos;hello\n&apos;)</span><br><span class="line">&gt;&gt;&gt; c.recvline()</span><br><span class="line">&apos;hello\n&apos;</span><br><span class="line">&gt;&gt;&gt; r.sendline(&apos;hello&apos;)</span><br><span class="line">&gt;&gt;&gt; c.recv()</span><br><span class="line">&apos;hello\n&apos;</span><br><span class="line">&gt;&gt;&gt; r.sendline(&apos;hello&apos;)</span><br><span class="line">&gt;&gt;&gt; c.recvline()</span><br><span class="line">&apos;hello\n&apos;</span><br><span class="line">&gt;&gt;&gt; r.sendline(&apos;hello&apos;)</span><br><span class="line">&gt;&gt;&gt; c.recvline(keepends=False)</span><br><span class="line">&apos;hello&apos;</span><br><span class="line">&gt;&gt;&gt; r.send(&apos;hello world&apos;)</span><br><span class="line">&gt;&gt;&gt; c.recvuntil(&apos;hello&apos;)</span><br><span class="line">&apos;hello&apos;</span><br><span class="line">&gt;&gt;&gt; c.recv()</span><br><span class="line">&apos; world&apos;</span><br><span class="line">&gt;&gt;&gt; c.close()</span><br><span class="line">[*] Closed connection to 127.0.0.1 port 38684</span><br><span class="line">&gt;&gt;&gt; r.close()</span><br><span class="line">[*] Closed connection to localhost port 46147</span><br></pre></td></tr></table></figure>
<p>下面是一个与进程交互的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; p = process(&apos;/bin/sh&apos;)</span><br><span class="line">[x] Starting local process &apos;/bin/sh&apos;</span><br><span class="line">[+] Starting local process &apos;/bin/sh&apos;: pid 26481</span><br><span class="line">&gt;&gt;&gt; p.sendline(&apos;sleep 3; echo hello world;&apos;)</span><br><span class="line">&gt;&gt;&gt; p.recvline(timeout=1)</span><br><span class="line">&apos;hello world\n&apos;</span><br><span class="line">&gt;&gt;&gt; p.sendline(&apos;sleep 3; echo hello world;&apos;)</span><br><span class="line">&gt;&gt;&gt; p.recvline(timeout=1)</span><br><span class="line">&apos;&apos;</span><br><span class="line">&gt;&gt;&gt; p.recvline(timeout=5)</span><br><span class="line">&apos;hello world\n&apos;</span><br><span class="line">&gt;&gt;&gt; p.interactive()</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">whoami</span><br><span class="line">firmy</span><br><span class="line">^C[*] Interrupted</span><br><span class="line">&gt;&gt;&gt; p.close()</span><br><span class="line">[*] Stopped process &apos;/bin/sh&apos; (pid 26481)</span><br></pre></td></tr></table></figure>
<h4 id="shellcraft">shellcraft</h4>
<p>使用 shellcraft 模块可以生成对应架构和 shellcode 代码，直接使用链式调用的方法就可以得到，首先指定体系结构，再指定操作系统：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print shellcraft.i386.nop().strip(&apos;\n&apos;)</span><br><span class="line">    nop</span><br><span class="line">&gt;&gt;&gt; print shellcraft.i386.linux.sh()</span><br><span class="line">    /* execve(path=&apos;/bin///sh&apos;, argv=[&apos;sh&apos;], envp=0) */</span><br><span class="line">    /* push &apos;/bin///sh\x00&apos; */</span><br><span class="line">    push 0x68</span><br><span class="line">    push 0x732f2f2f</span><br><span class="line">    push 0x6e69622f</span><br><span class="line">    mov ebx, esp</span><br><span class="line">    /* push argument array [&apos;sh\x00&apos;] */</span><br><span class="line">    /* push &apos;sh\x00\x00&apos; */</span><br><span class="line">    push 0x1010101</span><br><span class="line">    xor dword ptr [esp], 0x1016972</span><br><span class="line">    xor ecx, ecx</span><br><span class="line">    push ecx /* null terminate */</span><br><span class="line">    push 4</span><br><span class="line">    pop ecx</span><br><span class="line">    add ecx, esp</span><br><span class="line">    push ecx /* &apos;sh\x00&apos; */</span><br><span class="line">    mov ecx, esp</span><br><span class="line">    xor edx, edx</span><br><span class="line">    /* call execve() */</span><br><span class="line">    push SYS_execve /* 0xb */</span><br><span class="line">    pop eax</span><br><span class="line">    int 0x80</span><br><span class="line">    </span><br><span class="line">    shellcraft.sh()</span><br></pre></td></tr></table></figure>
<h4 id="asm">asm</h4>
<p>该模块用于汇编和反汇编代码。</p>
<p>体系结构，端序和字长需要在 <code>asm()</code> 和 <code>disasm()</code> 中设置，但为了避免重复，运行时变量最好使用 <code>pwnlib.context</code> 来设置。</p>
<p>汇编：(<code>pwnlib.asm.asm</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; asm(&apos;nop&apos;)</span><br><span class="line">&apos;\x90&apos;</span><br><span class="line">&gt;&gt;&gt; asm(shellcraft.nop())</span><br><span class="line">&apos;\x90&apos;</span><br><span class="line">&gt;&gt;&gt; asm(&apos;nop&apos;, arch=&apos;arm&apos;)</span><br><span class="line">&apos;\x00\xf0 \xe3&apos;</span><br><span class="line">&gt;&gt;&gt; context.arch = &apos;arm&apos;</span><br><span class="line">&gt;&gt;&gt; context.os = &apos;linux&apos;</span><br><span class="line">&gt;&gt;&gt; context.endian = &apos;little&apos;</span><br><span class="line">&gt;&gt;&gt; context.word_size = 32</span><br><span class="line">&gt;&gt;&gt; context</span><br><span class="line">ContextType(arch = &apos;arm&apos;, bits = 32, endian = &apos;little&apos;, os = &apos;linux&apos;)</span><br><span class="line">&gt;&gt;&gt; asm(&apos;nop&apos;)</span><br><span class="line">&apos;\x00\xf0 \xe3&apos;</span><br><span class="line">&gt;&gt;&gt; asm(&apos;mov eax, 1&apos;)</span><br><span class="line">&apos;\xb8\x01\x00\x00\x00&apos;</span><br><span class="line">&gt;&gt;&gt; asm(&apos;mov eax, 1&apos;).encode(&apos;hex&apos;)</span><br><span class="line">&apos;b801000000&apos;</span><br></pre></td></tr></table></figure>
<p>请注意，这里我们生成了 i386 和 arm 两种不同体系结构的 <code>nop</code>，当你使用不同与本机平台的汇编时，需要安装该平台的 binutils，方法在上面已经介绍过了。</p>
<p>反汇编：(<code>pwnlib.asm.disasm</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print disasm(&apos;\xb8\x01\x00\x00\x00&apos;)</span><br><span class="line">   0:   b8 01 00 00 00          mov    eax,0x1</span><br><span class="line">&gt;&gt;&gt; print disasm(&apos;6a0258cd80ebf9&apos;.decode(&apos;hex&apos;))</span><br><span class="line">   0:   6a 02                   push   0x2</span><br><span class="line">   2:   58                      pop    eax</span><br><span class="line">   3:   cd 80                   int    0x80</span><br><span class="line">   5:   eb f9                   jmp    0x0</span><br></pre></td></tr></table></figure>
<p>构建具有指定二进制数据的 ELF 文件：(<code>pwnlib.asm.make_elf</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; context.clear(arch=&apos;amd64&apos;)</span><br><span class="line">&gt;&gt;&gt; context</span><br><span class="line">ContextType(arch = &apos;amd64&apos;, bits = 64, endian = &apos;little&apos;)</span><br><span class="line">&gt;&gt;&gt; bin_sh = asm(shellcraft.amd64.linux.sh())</span><br><span class="line">&gt;&gt;&gt; bin_sh</span><br><span class="line">&apos;jhH\xb8/bin///sPH\x89\xe7hri\x01\x01\x814$\x01\x01\x01\x011\xf6Vj\x08^H\x01\xe6VH\x89\xe61\xd2j;X\x0f\x05&apos;</span><br><span class="line">&gt;&gt;&gt; filename = make_elf(bin_sh, extract=False)</span><br><span class="line">&gt;&gt;&gt; filename</span><br><span class="line">&apos;/tmp/pwn-asm-V4GWGN/step3-elf&apos;</span><br><span class="line">&gt;&gt;&gt; p = process(filename)</span><br><span class="line">[x] Starting local process &apos;/tmp/pwn-asm-V4GWGN/step3-elf&apos;</span><br><span class="line">[+] Starting local process &apos;/tmp/pwn-asm-V4GWGN/step3-elf&apos;: pid 28323</span><br><span class="line">&gt;&gt;&gt; p.sendline(&apos;echo hello&apos;)</span><br><span class="line">&gt;&gt;&gt; p.recv()</span><br><span class="line">&apos;hello\n&apos;</span><br></pre></td></tr></table></figure>
<p>这里我们生成了 amd64，即 64 位 <code>/bin/sh</code> 的 shellcode，配合上 asm 函数，即可通过 <code>make_elf</code> 得到 ELF 文件。</p>
<p>另一个函数 <code>pwnlib.asm.make_elf_from_assembly</code> 允许你构建具有指定汇编代码的 ELF 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; asm_sh = shellcraft.amd64.linux.sh()</span><br><span class="line">&gt;&gt;&gt; print asm_sh</span><br><span class="line">    /* execve(path=&apos;/bin///sh&apos;, argv=[&apos;sh&apos;], envp=0) */</span><br><span class="line">    /* push &apos;/bin///sh\x00&apos; */</span><br><span class="line">    push 0x68</span><br><span class="line">    mov rax, 0x732f2f2f6e69622f</span><br><span class="line">    push rax</span><br><span class="line">    mov rdi, rsp</span><br><span class="line">    /* push argument array [&apos;sh\x00&apos;] */</span><br><span class="line">    /* push &apos;sh\x00&apos; */</span><br><span class="line">    push 0x1010101 ^ 0x6873</span><br><span class="line">    xor dword ptr [rsp], 0x1010101</span><br><span class="line">    xor esi, esi /* 0 */</span><br><span class="line">    push rsi /* null terminate */</span><br><span class="line">    push 8</span><br><span class="line">    pop rsi</span><br><span class="line">    add rsi, rsp</span><br><span class="line">    push rsi /* &apos;sh\x00&apos; */</span><br><span class="line">    mov rsi, rsp</span><br><span class="line">    xor edx, edx /* 0 */</span><br><span class="line">    /* call execve() */</span><br><span class="line">    push SYS_execve /* 0x3b */</span><br><span class="line">    pop rax</span><br><span class="line">    syscall</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt; filename = make_elf_from_assembly(asm_sh)</span><br><span class="line">&gt;&gt;&gt; filename</span><br><span class="line">&apos;/tmp/pwn-asm-ApZ4_p/step3&apos;</span><br><span class="line">&gt;&gt;&gt; p = process(filename)</span><br><span class="line">[x] Starting local process &apos;/tmp/pwn-asm-ApZ4_p/step3&apos;</span><br><span class="line">[+] Starting local process &apos;/tmp/pwn-asm-ApZ4_p/step3&apos;: pid 28429</span><br><span class="line">&gt;&gt;&gt; p.sendline(&apos;echo hello&apos;)</span><br><span class="line">&gt;&gt;&gt; p.recv()</span><br><span class="line">&apos;hello\n&apos;</span><br></pre></td></tr></table></figure>
<p>与上一个函数不同的是，<code>make_elf_from_assembly</code> 直接从汇编生成 ELF 文件，并且保留了所有的符号，例如标签和局部变量等。</p>
<h4 id="elf">elf</h4>
<p>该模块用于 ELF 二进制文件的操作，包括符号查找、虚拟内存、文件偏移，以及修改和保存二进制文件等功能。(<code>pwnlib.elf.elf.ELF</code>)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; e = ELF(&apos;/bin/cat&apos;)</span><br><span class="line">[*] &apos;/bin/cat&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">&gt;&gt;&gt; print hex(e.address)</span><br><span class="line">0x400000</span><br><span class="line">&gt;&gt;&gt; print hex(e.symbols[&apos;write&apos;])</span><br><span class="line">0x401680</span><br><span class="line">&gt;&gt;&gt; print hex(e.got[&apos;write&apos;])</span><br><span class="line">0x60b070</span><br><span class="line">&gt;&gt;&gt; print hex(e.plt[&apos;write&apos;])</span><br><span class="line">0x401680</span><br></pre></td></tr></table></figure>
<p>上面的代码分别获得了 ELF 文件装载的基地址、函数地址、GOT 表地址和 PLT 表地址。</p>
<p>我们常常用它打开一个 libc.so，从而得到 system 函数的位置，这在 CTF 中是非常有用的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; e = ELF(&apos;/usr/lib/libc.so.6&apos;)</span><br><span class="line">[*] &apos;/usr/lib/libc.so.6&apos;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">&gt;&gt;&gt; print hex(e.symbols[&apos;system&apos;])</span><br><span class="line">0x42010</span><br></pre></td></tr></table></figure>
<p>我们甚至可以修改 ELF 文件的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; e = ELF(&apos;/bin/cat&apos;)</span><br><span class="line">&gt;&gt;&gt; e.read(e.address+1, 3)</span><br><span class="line">&apos;ELF&apos;</span><br><span class="line">&gt;&gt;&gt; e.asm(e.address, &apos;ret&apos;)</span><br><span class="line">&gt;&gt;&gt; e.save(&apos;/tmp/quiet-cat&apos;)</span><br><span class="line">&gt;&gt;&gt; disasm(file(&apos;/tmp/quiet-cat&apos;,&apos;rb&apos;).read(1))</span><br><span class="line">&apos;   0:   c3                      ret&apos;</span><br></pre></td></tr></table></figure>
<p>下面是一些常用函数：</p>
<ul>
<li><code>asm(address, assembly)</code>：汇编指定指令并插入到 ELF 的指定地址处，需要使用 ELF.save() 保存</li>
<li><code>bss(offset)</code>：返回 <code>.bss</code> 段加上 <code>offset</code> 后的地址</li>
<li><code>checksec()</code>：打印出文件使用的安全保护</li>
<li><code>disable_nx()</code>：关闭 NX</li>
<li><code>disasm(address, n_bytes)</code>：返回对指定虚拟地址进行反汇编后的字符串</li>
<li><code>offset_to_vaddr(offset)</code>：将指定偏移转换为虚拟地址</li>
<li><code>vaddr_to_offset(address)</code>：将指定虚拟地址转换为文件偏移</li>
<li><code>read(address, count)</code>：从指定虚拟地址读取 <code>count</code> 个字节的数据</li>
<li><code>write(address, data)</code>：在指定虚拟地址处写入 <code>data</code></li>
<li><code>section(name)</code>：获取 <code>name</code> 段的数据</li>
<li><code>debug()</code>：使用 <code>gdb.debug()</code> 进行调试</li>
</ul>
<p>最后还要注意一下 <code>pwnlib.elf.corefile</code>，它用于处理核心转储文件（Core Dump），当我们在写利用代码时，核心转储文件是非常有用的，关于它更详细的内容已经在前面 Linux基础一章中讲过，这里我们还是使用那一章中的示例代码，但使用 pwntools 来操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; core = Corefile(&apos;/tmp/core-a.out-30555-1507796886&apos;)</span><br><span class="line">[x] Parsing corefile...</span><br><span class="line">[*] &apos;/tmp/core-a.out-30555-1507796886&apos;</span><br><span class="line">    Arch:      i386-32-little</span><br><span class="line">    EIP:       0x565cd57b</span><br><span class="line">    ESP:       0x4141413d</span><br><span class="line">    Exe:       &apos;/home/firmy/a.out&apos; (0x565cd000)</span><br><span class="line">    Fault:     0x4141413d</span><br><span class="line">[+] Parsing corefile...: Done</span><br><span class="line">&gt;&gt;&gt; core.registers</span><br><span class="line">&#123;&apos;xds&apos;: 43, &apos;eip&apos;: 1448924539, &apos;xss&apos;: 43, &apos;esp&apos;: 1094795581, &apos;xgs&apos;: 99, &apos;edi&apos;: 0, &apos;orig_eax&apos;: 4294967295, &apos;xcs&apos;: 35, &apos;eax&apos;: 1, &apos;ebp&apos;: 1094795585, &apos;xes&apos;: 43, &apos;eflags&apos;: 66182, &apos;edx&apos;: 4151195744, &apos;ebx&apos;: 1094795585, &apos;xfs&apos;: 0, &apos;esi&apos;: 4151189032, &apos;ecx&apos;: 1094795585&#125;</span><br><span class="line">&gt;&gt;&gt; print core.maps</span><br><span class="line">565cd000-565ce000 r-xp 1000 /home/firmy/a.out</span><br><span class="line">565ce000-565cf000 r--p 1000 /home/firmy/a.out</span><br><span class="line">565cf000-565d0000 rw-p 1000 /home/firmy/a.out</span><br><span class="line">57b3c000-57b5e000 rw-p 22000</span><br><span class="line">f7510000-f76df000 r-xp 1cf000 /usr/lib32/libc-2.26.so</span><br><span class="line">f76df000-f76e0000 ---p 1000 /usr/lib32/libc-2.26.so</span><br><span class="line">f76e0000-f76e2000 r--p 2000 /usr/lib32/libc-2.26.so</span><br><span class="line">f76e2000-f76e3000 rw-p 1000 /usr/lib32/libc-2.26.so</span><br><span class="line">f76e3000-f76e6000 rw-p 3000</span><br><span class="line">f7722000-f7724000 rw-p 2000</span><br><span class="line">f7724000-f7726000 r--p 2000 [vvar]</span><br><span class="line">f7726000-f7728000 r-xp 2000 [vdso]</span><br><span class="line">f7728000-f774d000 r-xp 25000 /usr/lib32/ld-2.26.so</span><br><span class="line">f774d000-f774e000 r--p 1000 /usr/lib32/ld-2.26.so</span><br><span class="line">f774e000-f774f000 rw-p 1000 /usr/lib32/ld-2.26.so</span><br><span class="line">ffe37000-ffe58000 rw-p 21000 [stack]</span><br><span class="line">&gt;&gt;&gt; print hex(core.fault_addr)</span><br><span class="line">0x4141413d</span><br><span class="line">&gt;&gt;&gt; print hex(core.pc)</span><br><span class="line">0x565cd57b</span><br><span class="line">&gt;&gt;&gt; print core.libc</span><br><span class="line">f7510000-f76df000 r-xp 1cf000 /usr/lib32/libc-2.26.so</span><br></pre></td></tr></table></figure>
<h4 id="dynelf">dynelf</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwnlib.dynelf.DynELF</span><br></pre></td></tr></table></figure>
<p>该模块是专门用来应对无 libc 情况下的漏洞利用。它首先找到 glibc 的基地址，然后使用符号表和字符串表对所有符号进行解析，直到找到我们需要的函数的符号。</p>
<h4 id="fmtstr">fmtstr</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwnlib.fmtstr.FmtStr`，`pwnlib.fmtstr.fmtstr_payload</span><br></pre></td></tr></table></figure>
<p>该模块用于格式化字符串漏洞的利用，格式化字符串漏洞是 CTF 中一种常见的题型，我们会在后面的章节中详细讲述，关于该模块的使用也会留到那儿。</p>
<h4 id="gdb">gdb</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwnlib.gdb</span><br></pre></td></tr></table></figure>
<p>在写漏洞利用的时候，常常需要使用 gdb 动态调试，该模块就提供了这方面的支持。</p>
<p>两个常用函数：</p>
<ul>
<li><code>gdb.attach(target, gdbscript=None)</code>：在一个新终端打开 gdb 并 attach 到指定 PID 的进程，或是一个 <code>pwnlib.tubes</code> 对象。</li>
<li><code>gdb.debug(args, gdbscript=None)</code>：在新终端中使用 gdb 加载一个二进制文件。</li>
</ul>
<p>上面两种方法都可以在开启的时候传递一个脚本到 gdb，可以很方便地做一些操作，如自动设置断点。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># attach to pid 1234</span></span><br><span class="line">gdb.attach(<span class="number">1234</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># attach to a process</span></span><br><span class="line">bash = process(<span class="string">'bash'</span>)</span><br><span class="line">gdb.attach(bash, <span class="string">'''</span></span><br><span class="line"><span class="string">set follow-fork-mode child</span></span><br><span class="line"><span class="string">continue</span></span><br><span class="line"><span class="string">'''</span>)</span><br><span class="line">bash.sendline(<span class="string">'whoami'</span>)</span><br><span class="line"><span class="comment"># Create a new process, and stop it at 'main'</span></span><br><span class="line">io = gdb.debug(<span class="string">'bash'</span>, <span class="string">'''</span></span><br><span class="line"><span class="string"># Wait until we hit the main executable's entry point</span></span><br><span class="line"><span class="string">break _start</span></span><br><span class="line"><span class="string">continue</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># Now set breakpoint on shared library routines</span></span><br><span class="line"><span class="string">break malloc</span></span><br><span class="line"><span class="string">break free</span></span><br><span class="line"><span class="string">continue</span></span><br><span class="line"><span class="string">'''</span>)</span><br></pre></td></tr></table></figure>
<h4 id="memleak">memleak</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwnlib.memleak</span><br></pre></td></tr></table></figure>
<p>该模块用于内存泄露的利用。可用作装饰器。它会将泄露的内存缓存起来，在漏洞利用过程中可能会用到。</p>
<h4 id="util">util</h4>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwnlib.util.packing`, `pwnlib.util.cyclic</span><br></pre></td></tr></table></figure>
<p>util 其实是一些模块的集合，包含了一些实用的小工具。这里主要介绍两个，packing 和 cyclic。</p>
<p>packing 模块用于将整数打包和解包，它简化了标准库中的 <code>struct.pack</code> 和 <code>struct.unpack</code> 函数，同时增加了对任意宽度整数的支持。</p>
<p>使用 <code>p32</code>, <code>p64</code>, <code>u32</code>, <code>u64</code> 函数分别对 32 位和 64 位整数打包和解包，也可以使用 <code>pack()</code> 自己定义长度，另外添加参数 <code>endian</code> 和 <code>signed</code> 设置端序和是否带符号。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; p32(0xdeadbeef)</span><br><span class="line">&apos;\xef\xbe\xad\xde&apos;</span><br><span class="line">&gt;&gt;&gt; p64(0xdeadbeef).encode(&apos;hex&apos;)</span><br><span class="line">&apos;efbeadde00000000&apos;</span><br><span class="line">&gt;&gt;&gt; p32(0xdeadbeef, endian=&apos;big&apos;, sign=&apos;unsigned&apos;)</span><br><span class="line">&apos;\xde\xad\xbe\xef&apos;</span><br><span class="line">&gt;&gt;&gt; u32(&apos;1234&apos;)</span><br><span class="line">875770417</span><br><span class="line">&gt;&gt;&gt; u32(&apos;1234&apos;, endian=&apos;big&apos;, sign=&apos;signed&apos;)</span><br><span class="line">825373492</span><br><span class="line">&gt;&gt;&gt; u32(&apos;\xef\xbe\xad\xde&apos;)</span><br><span class="line">3735928559</span><br></pre></td></tr></table></figure>
<p>cyclic 模块在缓冲区溢出中很有用，它帮助生成模式字符串，然后查找偏移，以确定返回地址。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; cyclic(20)</span><br><span class="line">&apos;aaaabaaacaaadaaaeaaa&apos;</span><br><span class="line">&gt;&gt;&gt; cyclic_find(0x61616162)</span><br><span class="line">4</span><br></pre></td></tr></table></figure>
<h3 id="x34-pwntools-在-ctf-中的运用">0x34 Pwntools 在 CTF 中的运用</h3>
<p>可以在下面的仓库中找到大量使用 pwntools 的 write-up： <a href="https://github.com/Gallopsled/pwntools-write-ups" target="_blank" rel="noopener">pwntools-write-ups</a></p>
<hr>
<h2 id="x40-ollydbg">0x40 OllyDbg</h2>
<h3 id="x41-ollydbg调试器基本操作">0x41 OllyDbg调试器基本操作</h3>
<div style="text-align: center;">
<figure>
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/1543165695976.png" alt="OD界面介绍"><figcaption>OD界面介绍</figcaption>
</figure>
</div>
<h4 id="加载程序">① 加载程序</h4>
<ol type="1">
<li>加载程序：OllyDbg可以用两种方式加载目标程序进行调试，一种是通过<strong>CreateProcess创建进程</strong>；另外一种是利用<code>DebugActiveProcess</code>函数将调试器<strong>捆绑到一个正在运行的进程上</strong>。 2.利用CreateProcess创建进程：单击菜单“File/Open”或者<strong>按快捷键F3</strong>打开目标文件，这样会调用<code>CreateProcess</code>创建一个用以调试的进进程。OllyDbg将接收目标进程发送的调试事件，并对相应的对调试事件进行处理。</li>
<li>OllyDbg除了直接加载目标程序，也支持带参数的程序，方法是：在打开对话框中的“Arguments”栏中输入参数。如下图所示：
<div style="text-align: center;">
<img src="/2019/06/06/0.1-菜鸟学PWN之工具篇/1543164648498.png" title="fig:" alt="1543164648498"></div></li>
</ol>

<ol start="5" type="1">
<li><strong>将OllyDbg附加到一个正在运行的进程</strong>：OllyDbg一个实用的功能是可以调试正在运行的程序，这个功能称为”附加（Attach）“。其原理是利用<code>DebugActiveProcess</code>函数将调试器捆绑到一个正在运行的进程上，如果执行成功，则类似利用<code>CreateProcess</code>创建新进程。</li>
<li>单击菜单”File/Attach“打开<strong>附加对话框</strong>。选择正在运行的目标进程，单击Attach按钮即可附加到目标进程。附加后，目标程序会暂停在Ntdll.dll中的DbgBreakPoint处，按下<strong>F9或者shift+F9</strong>就可以让程序继续运行。接着对目标程序进行调试分析。</li>
<li>如果进程是隐藏的，OllyDbg有一个<code>-p</code>启动参数，只要得到进程的pid就可以附加了。可以利用IceSword等工具获得隐藏进程的PID，然后在控制台下用 -p 参数附加即可。注意，<strong>pid的值是十进制</strong></li>
<li><strong>单步跟踪</strong>：调试器一个最基本的功能就是动态跟踪，OllyDbg在菜单“Debug”里有控制运行的命令，各个菜单项有对应的快捷键。</li>
</ol>
<table>
<thead>
<tr class="header">
<th>OllyDbg功能键</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>F7</td>
<td>单步步进，遇到Call跟进</td>
</tr>
<tr class="even">
<td>F8</td>
<td>单步步过，遇到CALL跳过，不跟进</td>
</tr>
<tr class="odd">
<td>Ctrl+F9</td>
<td>直到出现RET指令时中断</td>
</tr>
<tr class="even">
<td>Alt+F9</td>
<td>若进入系统领空，此命令可以回到应用程序领空。</td>
</tr>
<tr class="odd">
<td>F9</td>
<td>运行程序</td>
</tr>
</tbody>
</table>
<ol start="9" type="1">
<li><p>F8键在调试中用的很频繁，可以一句句地<strong>单步执行</strong>汇编指令，<strong>遇到CALL指令不会跟进</strong>，而是路过。而F7的差别就主要在于，遇到CALL、LOOP等指令是<strong>会跟进去</strong>。</p></li>
<li><p>如果是<strong>重复多次调用F7或者F8</strong>时，OllyDbg提供了<strong>“Ctrl+F7”和“Ctrl+F8”</strong>快捷键，直到按下<strong>Esc键、F12键</strong>或者遇到断点时停止。</p></li>
<li><p>当<strong>位于某个CALL</strong>中，想回到调用这个CALL的地方时，可以按下<strong>“Ctrl+F9”</strong>快捷键，执行“执行到返回（Execute till return）”功能。OllyDbg就会停在<strong>遇到的第一个返回命令</strong>（RET、RETF或者IRET。可以设置为停在刚执行完RET等的位置）.</p></li>
<li><p>而如果<strong>跟进系统DLL提供的API函数</strong>中，此时想<strong>返回到应用程序领空里</strong>，可以按快捷键<strong>“Alt+F9”</strong>执行<strong>“Execute till user code”</strong>(执行到用户代码)命令。</p></li>
</ol>
<h4 id="设置断点">② 设置断点</h4>
<ol type="1">
<li><strong>设置断点</strong>：断点是调试器的一个<strong>重要功能</strong>，可以<strong>让程序中断在需要的地方</strong>，从而方便分析。最常用的断点是INT3断点，其原理是OllyDbg将断点地址处代码修改为INT3 指令。设置断点的<strong>快捷键是F2</strong>，<strong>再按一次F2取消断点</strong>；也可以用鼠标双击“Hex dump”列来设置断点。</li>
<li><strong>调试分析</strong>：字符串通常利用<strong>Window文件框输入</strong>。为了检查输入字符，程序通常采用下面的函数将文本框中的内容读取出来。</li>
</ol>
<table>
<thead>
<tr class="header">
<th>字符串读取函数</th>
<th>32位（ANSI版本）</th>
<th>32位（Unicode版本）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>GetDlgItemText</td>
<td>GetDlgItemTextA</td>
<td>GetDlgItemTextW</td>
</tr>
<tr class="even">
<td>GetWindowText</td>
<td>GetWindowTextA</td>
<td>GetWindowTextW</td>
</tr>
</tbody>
</table>
<ol start="3" type="1">
<li><p>一般情况下事先不知道程序具体会调用什么函数来取字符串，只好多试几次（经验比较重要）</p></li>
<li><p>还可以<strong>利用输入表设置断点</strong>。在OllyDbg中，按下<strong>"Ctrl+N"</strong>这个快捷键打开应用程序输入表，会发现应用程序调用的其他模块的导出函数，找到相应的函数后，通过Enter键即可切换到相应的代码，<strong>接下来按F2设置断点</strong>。</p></li>
<li><p>另一种方法：使用<strong>“Ctrl+G“</strong>键打开<strong>跟随表达式</strong>的窗口，输入GetDlgItemTextA字符串，单击OK按钮，会来到GetDlgItemTextA函数入口处，在0x77D6AC1E处下断点.</p></li>
<li><p>在阅读代码时：</p></li>
</ol>
<ul>
<li>要搞清楚<strong>各个API函数的定义</strong>（查看相关API手册）。</li>
<li>API函数基本采用的是**_stdcall调用约定<strong>，即函数入口参数按</strong>从右到左<strong>的顺序入栈，</strong>由被调用者清理栈中参数，返回值放在eax中**。因此，对相关的API函数要分析其前的push指令，这些指令将参数放进堆栈以供API调用。整个过程要关注堆栈的变化。</li>
<li>C代码中的子程序采用的是C调用约定，参数入口按照从右到左的顺序入栈，由调用者清理栈总参数。</li>
</ul>
<h4 id="找关键比较">③ 找关键比较</h4>
<ul>
<li><strong>找到关键比较位置</strong>：程序在进行验证时，一般会在关键位置进行比较，如果验证通过，则程序会跳转到正确的流程；如果程序验证不通过，则会跳转到错误的流程执行，在进行破解时一般只要找到比较的关键位置，将<strong>代码修改后然后保存</strong>到文件中即可完成对程序的暴力破解。</li>
<li>目前修改的是内存中的数据，为了使修改一直有效，就必须将这个变化写进磁盘文件中。</li>
<li><strong>保存方法</strong>：用鼠标<strong>选中修改过的代码</strong>，单击鼠标右键，执行“Copy to excutable/Selection”命令，将打开<strong>文件编辑窗口</strong>，单击鼠标右键，执行命令<strong>“Save File ”</strong>即可将修改保存到文件中。</li>
<li>像这种通过修改文件然后屏蔽程序某些功能或改变程序流程，使程序保护方法失效的方法称为<strong>patch(补丁)或“爆破”</strong></li>
</ul>

      
      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2019/06/06/0.1-菜鸟学PWN之工具篇/">0.1-菜鸟学PWN之工具篇</a></p>
        <p><span>文章作者:</span><a href="/" title="访问 killshadow 的个人博客">killshadow</a></p>
        <p><span>发布时间:</span>2019年06月06日 - 11时34分</p>
        <p><span>最后更新:</span>2019年06月06日 - 15时23分</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2019/06/06/0.1-菜鸟学PWN之工具篇/" title="0.1-菜鸟学PWN之工具篇">http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/</a>
            <span class="copy-path" data-clipboard-text="原文: http://www.killshadow.xyz/2019/06/06/0.1-菜鸟学PWN之工具篇/　　作者: killshadow" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script src="/js/clipboard.min.js"></script>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)" target = "_blank">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



<nav id="article-nav">
  
    <a href="/2019/06/06/1.2-菜鸟学PWN之栈溢出学习/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption"><</strong>
      <div class="article-nav-title">
        
          1.2-菜鸟学PWN之ROP学习
        
      </div>
    </a>
  
  
    <a href="/2019/06/06/隐写术(四)--CTF总结/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">隐写术(四)--总结</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>

    <div id="toc" class="toc-article">
    <strong class="toc-title">文章目录</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#x00-简介"><span class="toc-number">1.</span> <span class="toc-text">0x00 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x10-ida-pro"><span class="toc-number">2.</span> <span class="toc-text">0x10 IDA Pro</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x11-快捷键"><span class="toc-number">2.1.</span> <span class="toc-text">0x11 快捷键</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x12-常用插件"><span class="toc-number">2.2.</span> <span class="toc-text">0x12 常用插件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x13-常用技巧"><span class="toc-number">2.3.</span> <span class="toc-text">0x13 常用技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#堆栈不平衡"><span class="toc-number">2.3.1.</span> <span class="toc-text">① 堆栈不平衡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分析选项"><span class="toc-number">2.3.2.</span> <span class="toc-text">② 分析选项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#修改数据"><span class="toc-number">2.3.3.</span> <span class="toc-text">③ 修改数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建结构体"><span class="toc-number">2.3.4.</span> <span class="toc-text">④ 创建结构体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#解析c头文件"><span class="toc-number">2.3.5.</span> <span class="toc-text">⑤ 解析C头文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义数组"><span class="toc-number">2.3.6.</span> <span class="toc-text">⑥ 定义数组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动态调试-远程调试"><span class="toc-number">2.3.7.</span> <span class="toc-text">⑦ 动态调试 &amp; 远程调试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x14-ida-python"><span class="toc-number">2.4.</span> <span class="toc-text">0x14 IDA Python</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x20-gdb"><span class="toc-number">3.</span> <span class="toc-text">0x20 GDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x21-gdb-的组成架构"><span class="toc-number">3.1.</span> <span class="toc-text">0x21 gdb 的组成架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x22-gdb-基本工作原理"><span class="toc-number">3.2.</span> <span class="toc-text">0x22 gdb 基本工作原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gdb-的三种调试方式"><span class="toc-number">3.2.1.</span> <span class="toc-text">gdb 的三种调试方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#断点的实现"><span class="toc-number">3.2.2.</span> <span class="toc-text">断点的实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x23-gdb-基本操作"><span class="toc-number">3.3.</span> <span class="toc-text">0x23 gdb 基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#break----b"><span class="toc-number">3.3.1.</span> <span class="toc-text">break -- b</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#info"><span class="toc-number">3.3.2.</span> <span class="toc-text">info</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disable----dis"><span class="toc-number">3.3.3.</span> <span class="toc-text">disable -- dis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#enable"><span class="toc-number">3.3.4.</span> <span class="toc-text">enable</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#clear"><span class="toc-number">3.3.5.</span> <span class="toc-text">clear</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#delete----d"><span class="toc-number">3.3.6.</span> <span class="toc-text">delete -- d</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#tbreak"><span class="toc-number">3.3.7.</span> <span class="toc-text">tbreak</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#watch"><span class="toc-number">3.3.8.</span> <span class="toc-text">watch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#step----s"><span class="toc-number">3.3.9.</span> <span class="toc-text">step -- s</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reverse-step"><span class="toc-number">3.3.10.</span> <span class="toc-text">reverse-step</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#next----n"><span class="toc-number">3.3.11.</span> <span class="toc-text">next -- n</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#reverse-next"><span class="toc-number">3.3.12.</span> <span class="toc-text">reverse-next</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#return"><span class="toc-number">3.3.13.</span> <span class="toc-text">return</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#finish----fin"><span class="toc-number">3.3.14.</span> <span class="toc-text">finish -- fin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#until----u"><span class="toc-number">3.3.15.</span> <span class="toc-text">until -- u</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#continue----c"><span class="toc-number">3.3.16.</span> <span class="toc-text">continue -- c</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#print----p"><span class="toc-number">3.3.17.</span> <span class="toc-text">print -- p</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x"><span class="toc-number">3.3.18.</span> <span class="toc-text">x</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#display"><span class="toc-number">3.3.19.</span> <span class="toc-text">display</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disassemble----disas"><span class="toc-number">3.3.20.</span> <span class="toc-text">disassemble -- disas</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#undisplay"><span class="toc-number">3.3.21.</span> <span class="toc-text">undisplay</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disable-display"><span class="toc-number">3.3.22.</span> <span class="toc-text">disable display</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#enable-display"><span class="toc-number">3.3.23.</span> <span class="toc-text">enable display</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#help----h"><span class="toc-number">3.3.24.</span> <span class="toc-text">help -- h</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#attach"><span class="toc-number">3.3.25.</span> <span class="toc-text">attach</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#run----r"><span class="toc-number">3.3.26.</span> <span class="toc-text">run -- r</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#backtrace----bt"><span class="toc-number">3.3.27.</span> <span class="toc-text">backtrace -- bt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ptype"><span class="toc-number">3.3.28.</span> <span class="toc-text">ptype</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set-follow-fork-mode"><span class="toc-number">3.3.29.</span> <span class="toc-text">set follow-fork-mode</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#thread-apply-all-bt"><span class="toc-number">3.3.30.</span> <span class="toc-text">thread apply all bt</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#generate-core-file"><span class="toc-number">3.3.31.</span> <span class="toc-text">generate-core-file</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#directory----dir"><span class="toc-number">3.3.32.</span> <span class="toc-text">directory -- dir</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x24-gdb-peda-gdb-gef"><span class="toc-number">3.4.</span> <span class="toc-text">0x24 gdb-peda (gdb-gef)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#安装"><span class="toc-number">3.4.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#peda命令"><span class="toc-number">3.4.2.</span> <span class="toc-text">peda命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#aslr"><span class="toc-number">3.4.2.1.</span> <span class="toc-text">aslr</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#asmsearch"><span class="toc-number">3.4.2.2.</span> <span class="toc-text">asmsearch</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#checksec"><span class="toc-number">3.4.2.3.</span> <span class="toc-text">checksec</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#cmpmem"><span class="toc-number">3.4.2.4.</span> <span class="toc-text">cmpmem</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#context"><span class="toc-number">3.4.2.5.</span> <span class="toc-text">context</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#crashdump"><span class="toc-number">3.4.2.6.</span> <span class="toc-text">crashdump</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#deactive"><span class="toc-number">3.4.2.7.</span> <span class="toc-text">deactive</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#distance"><span class="toc-number">3.4.2.8.</span> <span class="toc-text">distance</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#dumpargs"><span class="toc-number">3.4.2.9.</span> <span class="toc-text">dumpargs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#dumpmem"><span class="toc-number">3.4.2.10.</span> <span class="toc-text">dumpmem</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#dumprop"><span class="toc-number">3.4.2.11.</span> <span class="toc-text">dumprop</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#eflags"><span class="toc-number">3.4.2.12.</span> <span class="toc-text">eflags</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#elfsymbol"><span class="toc-number">3.4.2.13.</span> <span class="toc-text">elfsymbol</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#gennop"><span class="toc-number">3.4.2.14.</span> <span class="toc-text">gennop</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getfile"><span class="toc-number">3.4.2.15.</span> <span class="toc-text">getfile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#getpid"><span class="toc-number">3.4.2.16.</span> <span class="toc-text">getpid</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#goto"><span class="toc-number">3.4.2.17.</span> <span class="toc-text">goto</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#help"><span class="toc-number">3.4.2.18.</span> <span class="toc-text">help</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hexdump"><span class="toc-number">3.4.2.19.</span> <span class="toc-text">hexdump</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#hexprint"><span class="toc-number">3.4.2.20.</span> <span class="toc-text">hexprint</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#jmpcall"><span class="toc-number">3.4.2.21.</span> <span class="toc-text">jmpcall</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#loadmem"><span class="toc-number">3.4.2.22.</span> <span class="toc-text">loadmem</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#lookup"><span class="toc-number">3.4.2.23.</span> <span class="toc-text">lookup</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#nearpc"><span class="toc-number">3.4.2.24.</span> <span class="toc-text">nearpc</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#nextcall"><span class="toc-number">3.4.2.25.</span> <span class="toc-text">nextcall</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#nextjmp"><span class="toc-number">3.4.2.26.</span> <span class="toc-text">nextjmp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#nxtest"><span class="toc-number">3.4.2.27.</span> <span class="toc-text">nxtest</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#patch"><span class="toc-number">3.4.2.28.</span> <span class="toc-text">patch</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pattern"><span class="toc-number">3.4.2.29.</span> <span class="toc-text">pattern</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#payload"><span class="toc-number">3.4.2.30.</span> <span class="toc-text">payload</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pdisass"><span class="toc-number">3.4.2.31.</span> <span class="toc-text">pdisass</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pltbreak"><span class="toc-number">3.4.2.32.</span> <span class="toc-text">pltbreak</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#procinfo"><span class="toc-number">3.4.2.33.</span> <span class="toc-text">procinfo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#profile"><span class="toc-number">3.4.2.34.</span> <span class="toc-text">profile</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pyhelp"><span class="toc-number">3.4.2.35.</span> <span class="toc-text">pyhelp</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pshow"><span class="toc-number">3.4.2.36.</span> <span class="toc-text">pshow</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pset"><span class="toc-number">3.4.2.37.</span> <span class="toc-text">pset</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#readelf"><span class="toc-number">3.4.2.38.</span> <span class="toc-text">readelf</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#refsearch"><span class="toc-number">3.4.2.39.</span> <span class="toc-text">refsearch</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#reload"><span class="toc-number">3.4.2.40.</span> <span class="toc-text">reload</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ropgadget"><span class="toc-number">3.4.2.41.</span> <span class="toc-text">ropgadget</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ropsearch"><span class="toc-number">3.4.2.42.</span> <span class="toc-text">ropsearch</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#searchmemfind"><span class="toc-number">3.4.2.43.</span> <span class="toc-text">searchmem|find</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#set"><span class="toc-number">3.4.2.44.</span> <span class="toc-text">set</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#sgrep"><span class="toc-number">3.4.2.45.</span> <span class="toc-text">sgrep</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#shellcode"><span class="toc-number">3.4.2.46.</span> <span class="toc-text">shellcode</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#show"><span class="toc-number">3.4.2.47.</span> <span class="toc-text">show</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#skeleton"><span class="toc-number">3.4.2.48.</span> <span class="toc-text">skeleton</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#skipi"><span class="toc-number">3.4.2.49.</span> <span class="toc-text">skipi</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#snapshot"><span class="toc-number">3.4.2.50.</span> <span class="toc-text">snapshot</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#start"><span class="toc-number">3.4.2.51.</span> <span class="toc-text">start</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#stepuntil"><span class="toc-number">3.4.2.52.</span> <span class="toc-text">stepuntil</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#strings"><span class="toc-number">3.4.2.53.</span> <span class="toc-text">strings</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#substr"><span class="toc-number">3.4.2.54.</span> <span class="toc-text">substr</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#telescope"><span class="toc-number">3.4.2.55.</span> <span class="toc-text">telescope</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tracecall"><span class="toc-number">3.4.2.56.</span> <span class="toc-text">tracecall</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#traceinst"><span class="toc-number">3.4.2.57.</span> <span class="toc-text">traceinst</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#unptrace"><span class="toc-number">3.4.2.58.</span> <span class="toc-text">unptrace</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#utils"><span class="toc-number">3.4.2.59.</span> <span class="toc-text">utils</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#vmmap"><span class="toc-number">3.4.2.60.</span> <span class="toc-text">vmmap</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#waitfor"><span class="toc-number">3.4.2.61.</span> <span class="toc-text">waitfor</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#xinfo"><span class="toc-number">3.4.2.62.</span> <span class="toc-text">xinfo</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#xormem"><span class="toc-number">3.4.2.63.</span> <span class="toc-text">xormem</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#xprint"><span class="toc-number">3.4.2.64.</span> <span class="toc-text">xprint</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#xrefs"><span class="toc-number">3.4.2.65.</span> <span class="toc-text">xrefs</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#xuntil"><span class="toc-number">3.4.2.66.</span> <span class="toc-text">xuntil</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#使用-peda-和-python-编写-gdb-脚本"><span class="toc-number">3.4.3.</span> <span class="toc-text">使用 PEDA 和 Python 编写 gdb 脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#pedacmd"><span class="toc-number">3.4.3.1.</span> <span class="toc-text">pedacmd</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#peda"><span class="toc-number">3.4.3.2.</span> <span class="toc-text">peda</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#小工具"><span class="toc-number">3.4.3.3.</span> <span class="toc-text">小工具</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#单行交互式使用"><span class="toc-number">3.4.3.4.</span> <span class="toc-text">单行／交互式使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#外部脚本"><span class="toc-number">3.4.3.5.</span> <span class="toc-text">外部脚本</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x30-pwntools"><span class="toc-number">4.</span> <span class="toc-text">0x30 pwntools</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x31-安装"><span class="toc-number">4.1.</span> <span class="toc-text">0x31 安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x32-模块简介"><span class="toc-number">4.2.</span> <span class="toc-text">0x32 模块简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x33-使用-pwntools"><span class="toc-number">4.3.</span> <span class="toc-text">0x33 使用 Pwntools</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tubes"><span class="toc-number">4.3.1.</span> <span class="toc-text">tubes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#shellcraft"><span class="toc-number">4.3.2.</span> <span class="toc-text">shellcraft</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#asm"><span class="toc-number">4.3.3.</span> <span class="toc-text">asm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#elf"><span class="toc-number">4.3.4.</span> <span class="toc-text">elf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dynelf"><span class="toc-number">4.3.5.</span> <span class="toc-text">dynelf</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fmtstr"><span class="toc-number">4.3.6.</span> <span class="toc-text">fmtstr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gdb"><span class="toc-number">4.3.7.</span> <span class="toc-text">gdb</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#memleak"><span class="toc-number">4.3.8.</span> <span class="toc-text">memleak</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#util"><span class="toc-number">4.3.9.</span> <span class="toc-text">util</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x34-pwntools-在-ctf-中的运用"><span class="toc-number">4.4.</span> <span class="toc-text">0x34 Pwntools 在 CTF 中的运用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x40-ollydbg"><span class="toc-number">5.</span> <span class="toc-text">0x40 OllyDbg</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x41-ollydbg调试器基本操作"><span class="toc-number">5.1.</span> <span class="toc-text">0x41 OllyDbg调试器基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#加载程序"><span class="toc-number">5.1.1.</span> <span class="toc-text">① 加载程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#设置断点"><span class="toc-number">5.1.2.</span> <span class="toc-text">② 设置断点</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#找关键比较"><span class="toc-number">5.1.3.</span> <span class="toc-text">③ 找关键比较</span></a></li></ol></li></ol></li></ol>
</div>
<input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

<script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script>
    var valueHide = "隐藏目录";
    var valueShow = "显示目录";

    if ($(".left-col").is(":hidden")) {
        $("#tocButton").attr("value", valueShow);
    }
    $("#tocButton").click(function() {
        if ($("#toc").is(":hidden")) {
            $("#tocButton").attr("value", valueHide);
            $("#toc").slideDown(320);
        }
        else {
            $("#tocButton").attr("value", valueShow);
            $("#toc").slideUp(350);
        }
    })
    if ($(".toc").length < 1) {
        $("#toc, #tocButton").hide();
    }
</script>





<div class="bdsharebuttonbox">
	<a href="#" class="fx fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="fx fa-weixin bds_weixin" data-cmd="weixin" title="分享到微信"></a>
	<a href="#" class="fx fa-qq bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
	<a href="#" class="fx fa-facebook-official bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
	<a href="#" class="fx fa-twitter bds_twi" data-cmd="twi" title="分享到Twitter"></a>
	<a href="#" class="fx fa-linkedin bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
	<a href="#" class="fx fa-files-o bds_copy" data-cmd="copy" title="分享到复制网址"></a>
</div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>




    



    <div class="scroll" id="post-nav-button">
        
            <a href="/2019/06/06/1.2-菜鸟学PWN之栈溢出学习/" title="上一篇: 1.2-菜鸟学PWN之ROP学习">
                <i class="fa fa-angle-left"></i>
            </a>
        
        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>
        
            <a href="/2019/06/06/隐写术(四)--CTF总结/" title="下一篇: 隐写术(四)--总结">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>
    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/06/06/1.2-菜鸟学PWN之栈溢出学习/">1.2-菜鸟学PWN之ROP学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/06/0.1-菜鸟学PWN之工具篇/">0.1-菜鸟学PWN之工具篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/06/隐写术(四)--CTF总结/">隐写术(四)--总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/04/深度学习理论基础/">深度学习理论基础</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/29/隐写术(三)--JPEG隐写分析特征算法与理论/">隐写术(三)--JPEG隐写分析特征算法与理论</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/29/隐写术(二)--传统数字图像隐写算法/">隐写术(二)--传统数字图像隐写算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/29/隐写术(一)--简介/">隐写术(一)--简介</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/24/Ubuntu18.04+8x1080ti爆破环境从零搭建/">Ubuntu18.04+8x1080ti爆破环境从零搭建</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/1.1-菜鸟学PWN之栈溢出学习/">1.1-菜鸟学PWN之栈溢出学习</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/09/NFC开发笔记/">NFC开发笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/15/基于主机的卡模拟(HCE)概述/">基于主机的卡模拟(HCE)概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/10/某aes变种题分析/">某AES变种题分析</a></li></ul>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
    <script>
        $(".post-list").addClass("toc-article");
        $(".post-list-item a").attr("target","_blank");
        $("#post-nav-button > a:nth-child(2)").click(function() {
            $(".fa-bars, .fa-times").toggle();
            $(".post-list").toggle(300);
            if ($(".toc").length > 0) {
                $("#toc, #tocButton").toggle(200, function() {
                    if ($(".switch-area").is(":visible")) {
                        $("#tocButton").attr("value", valueHide);
                        }
                    })
            }
            else {
            }
        })
    </script>



    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2019 killshadow
            </div>
            <div class="footer-right">
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" >海贼到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 96;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


    <script type="text/javascript">
      window.onload = function(){
        document.getElementById("search").onclick = function(){
            console.log("search")
            search();
        }
      }
      function search(){
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
        (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','A1Pz-LKMXbrzcFg2FWi6','2.0.0');
      }
    </script>

  </div><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config("");
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>